<!DOCTYPE html><html><head><title>Twilio Chat</title><style>body, html {
  height:100%;
  width:100%;
  padding:0;
  margin:0;
  overflow:hidden;
  background-color:#ddd;
}
.wrapper {
  height:100%;
  width:100%;
}</style><link rel="shortcut icon" href="//twilio.com/bundles/marketing/img/favicons/favicon.ico"><link rel="apple-touch-icon" href="//twilio.com/bundles/marketing/img/favicons/favicon_57.png"><link rel="apple-touch-icon" sizes="72x72" href="//twilio.com/bundles/marketing/img/favicons/favicon_72.png"><link rel="apple-touch-icon" sizes="114x114" href="//twilio.com/bundles/marketing/img/favicons/favicon_114.png"><link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css"><link rel="stylesheet" href="viewsaurus.css"></head><body><div class="wrapper"><div id="viewsaurus" data-title="Twilio Chat"><div class="saurus-panes"><div class="saurus-prose"><div class="saurus-prose-header"><div class="title-outer"><span class="step-title">Twilio Chat</span></div></div><div class="saurus-nav-buttons"><div class="saurus-nav-button nav-overview"><div class="saurus-nav-button-inner"><i class="fa fa-fw fa-list"></i></div><div class="nav-divider"></div></div><div class="saurus-nav-button nav-previous"><div class="saurus-nav-button-inner"><a href=""> <i class="fa fa-fw fa-play fa-rotate-180"></i></a></div><div class="nav-divider"></div></div><div class="saurus-nav-button nav-next clickable"><div class="saurus-nav-button-inner"><a href="#1"> <i class="fa fa-fw fa-play"></i></a></div></div><div class="saurus-next-title"><span class="next-title-inner"></span></div></div><div class="saurus-progress-bar"></div><div class="saurus-start"><p>Learn to implement a simple chat application using Twilio Programmable Chat Client</p><a href="#0">Start Tutorial</a></div><div class="saurus-content"><div data-title="Twilio Chat Android" class="chapter"><div data-title="Introduction" data-file="app/src/main/AndroidManifest.xml" class="step"><h2 id="introduction">Introduction</h2>
<p>Ready to implement a chat application using Twilio Programmable Chat Client?
Here is how it works at a high level:</p>
<ol>
<li><p><a href="//www.twilio.com/chat">Twilio Programmable Chat</a> is the core product
we&#39;ll be using to handle all the chat functionality.</p>
</li>
<li><p>We use a server side app to generate <a href="//www.twilio.com/docs/api/chat/guides/identity">user access
tokens</a> which contains
all your Twilio account information. The Programmable chat Client uses this token
to connect with the API</p>
</li>
<li><p><a href="//media.twiliocdn.com/sdk/android/common/releases/0.6.1/docs/">Twilio Access Manager</a>
is the part of the SDK than handles access tokens and even refreshes them upon token
expiration.</p>
</li>
</ol>
<hr>
<p><strong>See Also:</strong></p>
<ul>
<li><a href="//www.twilio.com/docs/api/chat">Programmable Chat API</a></li>
<li><a href="//www.twilio.com/docs/api/chat/guides/channels">Channels and Messages</a></li>
<li><a href="//www.twilio.com/docs/api/chat/guides/create-tokens">User Identity &amp; Access Tokens</a></li>
<li><a href="//media.twiliocdn.com/sdk/android/chat/releases/0.11.2/docs/">Twilio Programmable Chat Client Reference</a></li>
<li><a href="//media.twiliocdn.com/sdk/android/common/releases/0.6.1/docs/">Twilio Access Manager Reference</a></li>
<li><a href="//www.twilio.com/docs/api/chat/guides/migration-guide-android-0110">Programmable Chat migration guide</a></li>
</ul>
</div><div data-title="Initializing the Client - Part 1" data-file="app/src/main/java/com/twilio/twiliochat/chat/accesstoken/AccessTokenFetcher.java" data-highlight="30-58" class="step"><h2 id="initializing-the-client-part-1-fetch-access-token">Initializing the Client - Part 1: Fetch access token</h2>
<p>The first thing you need to create a client is an access token. This token
holds information about your Twilio account and Programmable Chat API keys. We have created a web
version of Twilio chat in different languages. You can use any of these to generate the token:</p>
<ul>
<li><a href="//github.com/TwilioDevEd/twiliochat-laravel">PHP - Laravel</a></li>
<li><a href="//github.com/TwilioDevEd/twiliochat-csharp">C# - .NET MVC</a></li>
<li><a href="//github.com/TwilioDevEd/twiliochat-servlets">Java - Servlets</a></li>
<li><a href="//github.com/TwilioDevEd/twiliochat-node">JS - Node</a></li>
</ul>
<p>We use <a href="//developer.android.com/training/volley/index.html">Volley</a>
to make a request to our server and get the access token.</p>
<hr>
<p><strong>See Also:</strong></p>
<ul>
<li><a href="//developer.android.com/training/volley/requestqueue.html">Set up a request queue with Volley</a></li>
</ul>
</div><div data-title="Initializing the Client - Part 2" data-file="app/src/main/java/com/twilio/twiliochat/chat/ChatClientBuilder.java" data-highlight="19-31" class="step"><h2 id="initializing-the-client-part-2-build-the-client">Initializing the Client - Part 2: Build the client</h2>
<p>Before creating a Programmable Chat Client instance we need to decide the
<a href="//www.twilio.com/docs/api/client/regions">region</a> it will connect to and the
<a href="//www.twilio.com/docs/api/chat/guides/initializing-sdk-clients#mobile-sdks">synchronization strategy</a>
used to initialize it.</p>
<p>We can then pass this information along with the access token generated in the previous step and wait for the
client to be ready.</p>
<p>Once the client has initialized, we can use it to get a list of available channels. Let&#39;s see
 how to do this on the next step.</p>
</div><div data-title="Getting the Channel List" data-file="app/src/main/java/com/twilio/twiliochat/chat/channels/ChannelManager.java" data-highlight="69-111" class="step"><h2 id="getting-the-channel-list">Getting the Channel List</h2>
<p>Our <code>ChannelManager</code> class takes care of everything related to channels.
The first thing we need to do, when the class is initialized, is to store
a list of channels of type <code>Channels</code>. For this we call the method <code>getChannels</code>
from the Programmable Chat Client and extract a <code>Channel</code> object from each
<code>ChannelDescriptor</code> returned.</p>
</div><div data-title="Listen to Client Events" data-file="app/src/main/java/com/twilio/twiliochat/chat/MainChatActivity.java" data-highlight="455-470" class="step"><h2 id="listen-to-client-events">Listen to Client Events</h2>
<p>The Programmable Chat Client will trigger events such as <code>onChannelAdd</code> or <code>onChannelDelete</code>
on our application. Given the creation or deletion of a channel we&#39;ll reload the
channel list in the sliding panel. If a channel is deleted and we were currently joined to that
channel, the application will automatically join the general channel.</p>
<p>You must set your <code>ChatClient</code> to listen to events using a
<a href="//media.twiliocdn.com/sdk/android/chat/releases/0.11.2/docs/com/twilio/chat/ChatClientListener.html">ChatClientListener</a>.
In this particular case, <code>MainChatActivity</code> implements ChatClientListener, but it&#39;s methods
are called from the <code>ChannelManager</code> class that also implements ChatClientListener (who actually is the
client&#39;s listener).
<code>ChannelManager</code> is used as an event handler proxy.
Twilio chat sets the listener when loading the channels.</p>
<hr>
<p><strong>See Also:</strong></p>
<ul>
<li><a href="//media.twiliocdn.com/sdk/android/chat/releases/0.11.2/docs/com/twilio/chat/ChatClientListener.html">ChatClientListener available events</a></li>
</ul>
</div><div data-title="Join the General Channel" data-file="app/src/main/java/com/twilio/twiliochat/chat/channels/ChannelManager.java" data-highlight="131-178" class="step"><h2 id="join-the-general-channel">Join the General Channel</h2>
<p>This application will try to join a channel called &quot;General Channel&quot; when it starts.
If the channel doesn&#39;t exist it&#39;ll create one with that name. The scope of
this example application will show you how to work only with public channels
but the Programmable Chat Client allows you to create private channels and handle
invitations.</p>
<p>Notice we set a unique name for the general channel as we don&#39;t want to
create a new general channel every time we start the application.</p>
</div><div data-title="Listen to Channel Events" data-file="app/src/main/java/com/twilio/twiliochat/chat/MainChatFragment.java" data-highlight="173-188" class="step"><h2 id="listen-to-channel-events">Listen to Channel Events</h2>
<p>We set a channel&#39;s listener to <code>MainChatFragment</code> that implements <code>ChannelListener</code>,
and here we implemented the following methods that listen to channel events:</p>
<ul>
<li><code>onMessageAdd</code>: When someone sends a message to the channel you are connected to.</li>
<li><code>onMemberJoin</code>: When someone joins the channel.</li>
<li><code>onMemberDelete</code>: When someone leaves the channel.</li>
</ul>
<p>As you may have noticed, each one of these methods include useful objects
as parameters. One example is the actual message that was added to the channel.</p>
</div><div data-title="Joining Other Channels" data-file="app/src/main/java/com/twilio/twiliochat/chat/MainChatFragment.java" data-highlight="88-128" class="step"><h2 id="joining-other-channels">Joining Other Channels</h2>
<p>The application uses a <a href="//developer.android.com/reference/android/support/v4/widget/DrawerLayout.html">Drawer Layout</a>
to show a list of the channels created for that Twilio account.</p>
<p>When you tap on the name of a channel, from the sidebar, that channel is set
on the <code>MainChatFragment</code>. The <code>setCurrentChannel</code> method takes care of joining
to the selected channel and loading the messages.</p>
</div><div data-title="Creating a Channel" data-file="app/src/main/java/com/twilio/twiliochat/chat/channels/ChannelManager.java" data-highlight="113-129" class="step"><h2 id="creating-a-channel">Creating a Channel</h2>
<p>We use an input dialog so the user can type the name of the new channel.
The only restriction here is that the user can&#39;t create a channel called
&quot;General Channel&quot;. Other than that, creating a channel is as simple as using
the <code>channelBuilder</code> as shown and providing at the very least a channel type.</p>
<p>You can provide additional parameters to the builder as we did
with general channel to set a unique name. There&#39;s a list of methods you can use
<a href="//media.twiliocdn.com/sdk/android/chat/releases/0.11.2/docs/">in the client library API docs</a>.</p>
</div><div data-title="Deleting a Channel" data-file="app/src/main/java/com/twilio/twiliochat/chat/channels/ChannelManager.java" data-highlight="65-67" class="step"><h2 id="deleting-a-channel">Deleting a Channel</h2>
<p>Deleting a channel is easier than creating one. The application
lets the user delete the channel they are currently joined to through a menu
option. In order to delete the channel from Twilio you have to call
the <code>destroy</code> method on the channel you are trying to delete. But you still
need to provide a <code>StatusListener</code> to handle the success or failure of the operation.</p>
</div><div data-title="Where to Next?" class="step"><p>That&#39;s it! We&#39;ve just implemented a simple chat application for Android.</p>
<h2 id="did-this-help-">Did this help?</h2>
<p>Thanks for checking out this tutorial! If you have any feedback to share
with us, we&#39;d love to hear it. Tweet
<a href="//twitter.com/twilio">@twilio</a> to let us know what you think.</p>
</div></div>
<div class="saurus-files" style="display:none;"><textarea class="saurus-file" data-file="app/src/main/AndroidManifest.xml" data-mode="xml">PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPG1hbmlmZXN0CiAgICBwYWNrYWdlPSJjb20udHdpbGlvLnR3aWxpb2NoYXQiCiAgICB4bWxuczphbmRyb2lkPSJodHRwOi8vc2NoZW1hcy5hbmRyb2lkLmNvbS9hcGsvcmVzL2FuZHJvaWQiPgoKICAgIDx1c2VzLXBlcm1pc3Npb24gYW5kcm9pZDpuYW1lPSJhbmRyb2lkLnBlcm1pc3Npb24uSU5URVJORVQiLz4KICAgIDx1c2VzLXBlcm1pc3Npb24gYW5kcm9pZDpuYW1lPSJhbmRyb2lkLnBlcm1pc3Npb24uQUNDRVNTX05FVFdPUktfU1RBVEUiLz4KICAgIDx1c2VzLXBlcm1pc3Npb24gYW5kcm9pZDpuYW1lPSJhbmRyb2lkLnBlcm1pc3Npb24uQUNDRVNTX1dJRklfU1RBVEUiLz4KICAgIDx1c2VzLXBlcm1pc3Npb24gYW5kcm9pZDpuYW1lPSJhbmRyb2lkLnBlcm1pc3Npb24uV0FLRV9MT0NLIi8+CgogICAgPHVzZXMtcGVybWlzc2lvbiBhbmRyb2lkOm5hbWU9ImNvbS5nb29nbGUuYW5kcm9pZC5jMmRtLnBlcm1pc3Npb24uUkVDRUlWRSIgLz4KICAgIDxwZXJtaXNzaW9uIGFuZHJvaWQ6bmFtZT0iY29tLnR3aWxpby5jaGF0LmRlbW8ucGVybWlzc2lvbi5DMkRfTUVTU0FHRSIgYW5kcm9pZDpwcm90ZWN0aW9uTGV2ZWw9InNpZ25hdHVyZSIgLz4KICAgIDx1c2VzLXBlcm1pc3Npb24gYW5kcm9pZDpuYW1lPSJjb20udHdpbGlvLmNoYXQuZGVtby5wZXJtaXNzaW9uLkMyRF9NRVNTQUdFIiAvPgoKCiAgICA8YXBwbGljYXRpb24KICAgICAgICBhbmRyb2lkOm5hbWU9Ii5hcHBsaWNhdGlvbi5Ud2lsaW9DaGF0QXBwbGljYXRpb24iCiAgICAgICAgYW5kcm9pZDphbGxvd0JhY2t1cD0idHJ1ZSIKICAgICAgICBhbmRyb2lkOmljb249IkBtaXBtYXAvaWNfbGF1bmNoZXIiCiAgICAgICAgYW5kcm9pZDpsYWJlbD0iQHN0cmluZy9hcHBfbmFtZSIKICAgICAgICBhbmRyb2lkOnN1cHBvcnRzUnRsPSJ0cnVlIgogICAgICAgIGFuZHJvaWQ6dGhlbWU9IkBzdHlsZS9BcHBUaGVtZSI+CgogICAgICAgIDxhY3Rpdml0eQogICAgICAgICAgICBhbmRyb2lkOm5hbWU9Ii5sYW5kaW5nLkxhdW5jaEFjdGl2aXR5IgogICAgICAgICAgICBhbmRyb2lkOmxhYmVsPSJAc3RyaW5nL2FwcF9uYW1lIj4KICAgICAgICAgICAgPGludGVudC1maWx0ZXI+CiAgICAgICAgICAgICAgICA8YWN0aW9uIGFuZHJvaWQ6bmFtZT0iYW5kcm9pZC5pbnRlbnQuYWN0aW9uLk1BSU4iLz4KCiAgICAgICAgICAgICAgICA8Y2F0ZWdvcnkgYW5kcm9pZDpuYW1lPSJhbmRyb2lkLmludGVudC5jYXRlZ29yeS5MQVVOQ0hFUiIvPgogICAgICAgICAgICA8L2ludGVudC1maWx0ZXI+CiAgICAgICAgPC9hY3Rpdml0eT4KICAgICAgICA8YWN0aXZpdHkKICAgICAgICAgICAgYW5kcm9pZDpuYW1lPSIubGFuZGluZy5Mb2dpbkFjdGl2aXR5IgogICAgICAgICAgICBhbmRyb2lkOnNjcmVlbk9yaWVudGF0aW9uPSJwb3J0cmFpdCIvPgogICAgICAgIDxhY3Rpdml0eQogICAgICAgICAgICBhbmRyb2lkOm5hbWU9Ii5jaGF0Lk1haW5DaGF0QWN0aXZpdHkiCiAgICAgICAgICAgIGFuZHJvaWQ6Y29uZmlnQ2hhbmdlcz0ib3JpZW50YXRpb258c2NyZWVuU2l6ZSIKICAgICAgICAgICAgYW5kcm9pZDpsYWJlbD0iQHN0cmluZy90aXRsZV9hY3Rpdml0eV9tYWluX2NoYXQiCiAgICAgICAgICAgIGFuZHJvaWQ6dGhlbWU9IkBzdHlsZS9BcHBUaGVtZS5Ob0FjdGlvbkJhciIvPgogICAgPC9hcHBsaWNhdGlvbj4KCjwvbWFuaWZlc3Q+Cg==</textarea>
<textarea class="saurus-file" data-file="app/src/main/java/com/twilio/twiliochat/chat/accesstoken/AccessTokenFetcher.java" data-mode="java">cGFja2FnZSBjb20udHdpbGlvLnR3aWxpb2NoYXQuY2hhdC5hY2Nlc3N0b2tlbjsKCmltcG9ydCBhbmRyb2lkLmNvbnRlbnQuQ29udGV4dDsKaW1wb3J0IGFuZHJvaWQuY29udGVudC5yZXMuUmVzb3VyY2VzOwppbXBvcnQgYW5kcm9pZC5wcm92aWRlci5TZXR0aW5nczsKCmltcG9ydCBjb20uYW5kcm9pZC52b2xsZXkuUmVxdWVzdDsKaW1wb3J0IGNvbS5hbmRyb2lkLnZvbGxleS5SZXNwb25zZTsKaW1wb3J0IGNvbS5hbmRyb2lkLnZvbGxleS5Wb2xsZXlFcnJvcjsKaW1wb3J0IGNvbS5hbmRyb2lkLnZvbGxleS50b29sYm94Lkpzb25PYmplY3RSZXF1ZXN0OwppbXBvcnQgY29tLnR3aWxpby50d2lsaW9jaGF0LlI7CmltcG9ydCBjb20udHdpbGlvLnR3aWxpb2NoYXQuYXBwbGljYXRpb24uU2Vzc2lvbk1hbmFnZXI7CmltcG9ydCBjb20udHdpbGlvLnR3aWxpb2NoYXQuYXBwbGljYXRpb24uVHdpbGlvQ2hhdEFwcGxpY2F0aW9uOwppbXBvcnQgY29tLnR3aWxpby50d2lsaW9jaGF0LmNoYXQubGlzdGVuZXJzLlRhc2tDb21wbGV0aW9uTGlzdGVuZXI7CgppbXBvcnQgb3JnLmpzb24uSlNPTkV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5qc29uLkpTT05PYmplY3Q7CgppbXBvcnQgamF2YS51dGlsLkhhc2hNYXA7CmltcG9ydCBqYXZhLnV0aWwuTWFwOwoKcHVibGljIGNsYXNzIEFjY2Vzc1Rva2VuRmV0Y2hlciB7CgogIHByaXZhdGUgQ29udGV4dCBjb250ZXh0OwoKICBwdWJsaWMgQWNjZXNzVG9rZW5GZXRjaGVyKENvbnRleHQgY29udGV4dCkgewogICAgdGhpcy5jb250ZXh0ID0gY29udGV4dDsKICB9CgogIHB1YmxpYyB2b2lkIGZldGNoKGZpbmFsIFRhc2tDb21wbGV0aW9uTGlzdGVuZXI8U3RyaW5nLCBTdHJpbmc+IGxpc3RlbmVyKSB7CiAgICBKU09OT2JqZWN0IG9iaiA9IG5ldyBKU09OT2JqZWN0KGdldFRva2VuUmVxdWVzdFBhcmFtcyhjb250ZXh0KSk7CiAgICBTdHJpbmcgcmVxdWVzdFVybCA9IGdldFN0cmluZ1Jlc291cmNlKFIuc3RyaW5nLnRva2VuX3VybCk7CgogICAgSnNvbk9iamVjdFJlcXVlc3QganNvbk9ialJlcSA9CiAgICAgICAgbmV3IEpzb25PYmplY3RSZXF1ZXN0KFJlcXVlc3QuTWV0aG9kLlBPU1QsIHJlcXVlc3RVcmwsIG9iaiwgbmV3IFJlc3BvbnNlLkxpc3RlbmVyPEpTT05PYmplY3Q+KCkgewoKICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgcHVibGljIHZvaWQgb25SZXNwb25zZShKU09OT2JqZWN0IHJlc3BvbnNlKSB7CiAgICAgICAgICAgIFN0cmluZyB0b2tlbiA9IG51bGw7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgdG9rZW4gPSByZXNwb25zZS5nZXRTdHJpbmcoInRva2VuIik7CiAgICAgICAgICAgIH0gY2F0Y2ggKEpTT05FeGNlcHRpb24gZSkgewogICAgICAgICAgICAgIGUucHJpbnRTdGFja1RyYWNlKCk7CiAgICAgICAgICAgICAgbGlzdGVuZXIub25FcnJvcigiRmFpbGVkIHRvIHBhcnNlIHRva2VuIEpTT04gcmVzcG9uc2UiKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBsaXN0ZW5lci5vblN1Y2Nlc3ModG9rZW4pOwogICAgICAgICAgfQogICAgICAgIH0sIG5ldyBSZXNwb25zZS5FcnJvckxpc3RlbmVyKCkgewoKICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgcHVibGljIHZvaWQgb25FcnJvclJlc3BvbnNlKFZvbGxleUVycm9yIGVycm9yKSB7CgogICAgICAgICAgICBsaXN0ZW5lci5vbkVycm9yKCJGYWlsZWQgdG8gZmV0Y2ggdG9rZW4iKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIGpzb25PYmpSZXEuc2V0U2hvdWxkQ2FjaGUoZmFsc2UpOwogICAgVG9rZW5SZXF1ZXN0LmdldEluc3RhbmNlKCkuYWRkVG9SZXF1ZXN0UXVldWUoanNvbk9ialJlcSk7CiAgfQoKICBwcml2YXRlIE1hcDxTdHJpbmcsIFN0cmluZz4gZ2V0VG9rZW5SZXF1ZXN0UGFyYW1zKENvbnRleHQgY29udGV4dCkgewogICAgU3RyaW5nIGFuZHJvaWRJZCA9CiAgICAgICAgU2V0dGluZ3MuU2VjdXJlLmdldFN0cmluZyhjb250ZXh0LmdldENvbnRlbnRSZXNvbHZlcigpLCBTZXR0aW5ncy5TZWN1cmUuQU5EUk9JRF9JRCk7CiAgICBNYXA8U3RyaW5nLCBTdHJpbmc+IHBhcmFtcyA9IG5ldyBIYXNoTWFwPD4oKTsKICAgIHBhcmFtcy5wdXQoImRldmljZUlkIiwgYW5kcm9pZElkKTsKICAgIHBhcmFtcy5wdXQoImlkZW50aXR5IiwgU2Vzc2lvbk1hbmFnZXIuZ2V0SW5zdGFuY2UoKS5nZXRVc2VybmFtZSgpKTsKICAgIHJldHVybiBwYXJhbXM7CiAgfQoKICBwcml2YXRlIFN0cmluZyBnZXRTdHJpbmdSZXNvdXJjZShpbnQgaWQpIHsKICAgIFJlc291cmNlcyByZXNvdXJjZXMgPSBUd2lsaW9DaGF0QXBwbGljYXRpb24uZ2V0KCkuZ2V0UmVzb3VyY2VzKCk7CiAgICByZXR1cm4gcmVzb3VyY2VzLmdldFN0cmluZyhpZCk7CiAgfQoKfQo=</textarea>
<textarea class="saurus-file" data-file="app/src/main/java/com/twilio/twiliochat/chat/ChatClientBuilder.java" data-mode="java">cGFja2FnZSBjb20udHdpbGlvLnR3aWxpb2NoYXQuY2hhdDsKCmltcG9ydCBhbmRyb2lkLmNvbnRlbnQuQ29udGV4dDsKCmltcG9ydCBjb20udHdpbGlvLmNoYXQuQ2FsbGJhY2tMaXN0ZW5lcjsKaW1wb3J0IGNvbS50d2lsaW8uY2hhdC5DaGF0Q2xpZW50OwppbXBvcnQgY29tLnR3aWxpby5jaGF0LkVycm9ySW5mbzsKaW1wb3J0IGNvbS50d2lsaW8udHdpbGlvY2hhdC5jaGF0Lmxpc3RlbmVycy5UYXNrQ29tcGxldGlvbkxpc3RlbmVyOwoKcHVibGljIGNsYXNzIENoYXRDbGllbnRCdWlsZGVyIGV4dGVuZHMgQ2FsbGJhY2tMaXN0ZW5lcjxDaGF0Q2xpZW50PiB7CgogIHByaXZhdGUgQ29udGV4dCBjb250ZXh0OwogIHByaXZhdGUgVGFza0NvbXBsZXRpb25MaXN0ZW5lcjxDaGF0Q2xpZW50LCBTdHJpbmc+IGJ1aWxkTGlzdGVuZXI7CgogIHB1YmxpYyBDaGF0Q2xpZW50QnVpbGRlcihDb250ZXh0IGNvbnRleHQpIHsKICAgIHRoaXMuY29udGV4dCA9IGNvbnRleHQ7CiAgfQoKICBwdWJsaWMgdm9pZCBidWlsZChTdHJpbmcgdG9rZW4sIGZpbmFsIFRhc2tDb21wbGV0aW9uTGlzdGVuZXI8Q2hhdENsaWVudCwgU3RyaW5nPiBsaXN0ZW5lcikgewogICAgQ2hhdENsaWVudC5Qcm9wZXJ0aWVzIHByb3BzID0KICAgICAgICBuZXcgQ2hhdENsaWVudC5Qcm9wZXJ0aWVzLkJ1aWxkZXIoKQogICAgICAgICAgICAuc2V0U3luY2hyb25pemF0aW9uU3RyYXRlZ3koQ2hhdENsaWVudC5TeW5jaHJvbml6YXRpb25TdHJhdGVneS5DSEFOTkVMU19MSVNUKQogICAgICAgICAgICAuc2V0UmVnaW9uKCJ1czEiKQogICAgICAgICAgICAuY3JlYXRlUHJvcGVydGllcygpOwoKICAgIHRoaXMuYnVpbGRMaXN0ZW5lciA9IGxpc3RlbmVyOwogICAgQ2hhdENsaWVudC5jcmVhdGUoY29udGV4dC5nZXRBcHBsaWNhdGlvbkNvbnRleHQoKSwKICAgICAgICB0b2tlbiwKICAgICAgICBwcm9wcywKICAgICAgICB0aGlzKTsKICB9CgoKICBAT3ZlcnJpZGUKICBwdWJsaWMgdm9pZCBvblN1Y2Nlc3MoQ2hhdENsaWVudCBjaGF0Q2xpZW50KSB7CiAgICB0aGlzLmJ1aWxkTGlzdGVuZXIub25TdWNjZXNzKGNoYXRDbGllbnQpOwogIH0KCiAgQE92ZXJyaWRlCiAgcHVibGljIHZvaWQgb25FcnJvcihFcnJvckluZm8gZXJyb3JJbmZvKSB7CiAgICB0aGlzLmJ1aWxkTGlzdGVuZXIub25FcnJvcihlcnJvckluZm8uZ2V0RXJyb3JUZXh0KCkpOwogIH0KfQo=</textarea>
<textarea class="saurus-file" data-file="app/src/main/java/com/twilio/twiliochat/chat/channels/ChannelManager.java" data-mode="java">cGFja2FnZSBjb20udHdpbGlvLnR3aWxpb2NoYXQuY2hhdC5jaGFubmVsczsKCmltcG9ydCBhbmRyb2lkLmNvbnRlbnQucmVzLlJlc291cmNlczsKaW1wb3J0IGFuZHJvaWQub3MuSGFuZGxlcjsKaW1wb3J0IGFuZHJvaWQub3MuTG9vcGVyOwoKaW1wb3J0IGNvbS50d2lsaW8uY2hhdC5DYWxsYmFja0xpc3RlbmVyOwppbXBvcnQgY29tLnR3aWxpby5jaGF0LkNoYW5uZWw7CmltcG9ydCBjb20udHdpbGlvLmNoYXQuQ2hhbm5lbC5DaGFubmVsVHlwZTsKaW1wb3J0IGNvbS50d2lsaW8uY2hhdC5DaGFubmVsRGVzY3JpcHRvcjsKaW1wb3J0IGNvbS50d2lsaW8uY2hhdC5DaGFubmVsczsKaW1wb3J0IGNvbS50d2lsaW8uY2hhdC5DaGF0Q2xpZW50OwppbXBvcnQgY29tLnR3aWxpby5jaGF0LkNoYXRDbGllbnRMaXN0ZW5lcjsKaW1wb3J0IGNvbS50d2lsaW8uY2hhdC5FcnJvckluZm87CmltcG9ydCBjb20udHdpbGlvLmNoYXQuUGFnaW5hdG9yOwppbXBvcnQgY29tLnR3aWxpby5jaGF0LlN0YXR1c0xpc3RlbmVyOwppbXBvcnQgY29tLnR3aWxpby5jaGF0LlVzZXJJbmZvOwppbXBvcnQgY29tLnR3aWxpby50d2lsaW9jaGF0LlI7CmltcG9ydCBjb20udHdpbGlvLnR3aWxpb2NoYXQuYXBwbGljYXRpb24uVHdpbGlvQ2hhdEFwcGxpY2F0aW9uOwppbXBvcnQgY29tLnR3aWxpby50d2lsaW9jaGF0LmNoYXQuQ2hhdENsaWVudE1hbmFnZXI7CmltcG9ydCBjb20udHdpbGlvLnR3aWxpb2NoYXQuY2hhdC5saXN0ZW5lcnMuVGFza0NvbXBsZXRpb25MaXN0ZW5lcjsKCmltcG9ydCBqYXZhLnV0aWwuQXJyYXlMaXN0OwppbXBvcnQgamF2YS51dGlsLkNvbGxlY3Rpb25zOwppbXBvcnQgamF2YS51dGlsLkxpc3Q7CgpwdWJsaWMgY2xhc3MgQ2hhbm5lbE1hbmFnZXIgaW1wbGVtZW50cyBDaGF0Q2xpZW50TGlzdGVuZXIgewogIHByaXZhdGUgc3RhdGljIENoYW5uZWxNYW5hZ2VyIHNoYXJlZE1hbmFnZXIgPSBuZXcgQ2hhbm5lbE1hbmFnZXIoKTsKICBwdWJsaWMgQ2hhbm5lbCBnZW5lcmFsQ2hhbm5lbDsKICBwcml2YXRlIENoYXRDbGllbnRNYW5hZ2VyIGNoYXRDbGllbnRNYW5hZ2VyOwogIHByaXZhdGUgQ2hhbm5lbEV4dHJhY3RvciBjaGFubmVsRXh0cmFjdG9yOwogIHByaXZhdGUgTGlzdDxDaGFubmVsPiBjaGFubmVsczsKICBwcml2YXRlIENoYW5uZWxzIGNoYW5uZWxzT2JqZWN0OwogIHByaXZhdGUgQ2hhdENsaWVudExpc3RlbmVyIGxpc3RlbmVyOwogIHByaXZhdGUgU3RyaW5nIGRlZmF1bHRDaGFubmVsTmFtZTsKICBwcml2YXRlIFN0cmluZyBkZWZhdWx0Q2hhbm5lbFVuaXF1ZU5hbWU7CiAgcHJpdmF0ZSBIYW5kbGVyIGhhbmRsZXI7CiAgcHJpdmF0ZSBCb29sZWFuIGlzUmVmcmVzaGluZ0NoYW5uZWxzID0gZmFsc2U7CgogIHByaXZhdGUgQ2hhbm5lbE1hbmFnZXIoKSB7CiAgICB0aGlzLmNoYXRDbGllbnRNYW5hZ2VyID0gVHdpbGlvQ2hhdEFwcGxpY2F0aW9uLmdldCgpLmdldENoYXRDbGllbnRNYW5hZ2VyKCk7CiAgICB0aGlzLmNoYW5uZWxFeHRyYWN0b3IgPSBuZXcgQ2hhbm5lbEV4dHJhY3RvcigpOwogICAgdGhpcy5saXN0ZW5lciA9IHRoaXM7CiAgICBkZWZhdWx0Q2hhbm5lbE5hbWUgPSBnZXRTdHJpbmdSZXNvdXJjZShSLnN0cmluZy5kZWZhdWx0X2NoYW5uZWxfbmFtZSk7CiAgICBkZWZhdWx0Q2hhbm5lbFVuaXF1ZU5hbWUgPSBnZXRTdHJpbmdSZXNvdXJjZShSLnN0cmluZy5kZWZhdWx0X2NoYW5uZWxfdW5pcXVlX25hbWUpOwogICAgaGFuZGxlciA9IHNldHVwTGlzdGVuZXJIYW5kbGVyKCk7CiAgfQoKICBwdWJsaWMgc3RhdGljIENoYW5uZWxNYW5hZ2VyIGdldEluc3RhbmNlKCkgewogICAgcmV0dXJuIHNoYXJlZE1hbmFnZXI7CiAgfQoKICBwdWJsaWMgTGlzdDxDaGFubmVsPiBnZXRDaGFubmVscygpIHsKICAgIHJldHVybiBjaGFubmVsczsKICB9CgogIHB1YmxpYyBTdHJpbmcgZ2V0RGVmYXVsdENoYW5uZWxOYW1lKCkgewogICAgcmV0dXJuIHRoaXMuZGVmYXVsdENoYW5uZWxOYW1lOwogIH0KCiAgcHVibGljIHZvaWQgbGVhdmVDaGFubmVsV2l0aEhhbmRsZXIoQ2hhbm5lbCBjaGFubmVsLCBTdGF0dXNMaXN0ZW5lciBoYW5kbGVyKSB7CiAgICBjaGFubmVsLmxlYXZlKGhhbmRsZXIpOwogIH0KCiAgcHVibGljIHZvaWQgZGVsZXRlQ2hhbm5lbFdpdGhIYW5kbGVyKENoYW5uZWwgY2hhbm5lbCwgU3RhdHVzTGlzdGVuZXIgaGFuZGxlcikgewogICAgY2hhbm5lbC5kZXN0cm95KGhhbmRsZXIpOwogIH0KCiAgcHVibGljIHZvaWQgcG9wdWxhdGVDaGFubmVscyhmaW5hbCBMb2FkQ2hhbm5lbExpc3RlbmVyIGxpc3RlbmVyKSB7CiAgICBpZiAodGhpcy5jaGF0Q2xpZW50TWFuYWdlciA9PSBudWxsIHx8IHRoaXMuaXNSZWZyZXNoaW5nQ2hhbm5lbHMpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy5pc1JlZnJlc2hpbmdDaGFubmVscyA9IHRydWU7CgogICAgaGFuZGxlci5wb3N0KG5ldyBSdW5uYWJsZSgpIHsKICAgICAgQE92ZXJyaWRlCiAgICAgIHB1YmxpYyB2b2lkIHJ1bigpIHsKICAgICAgICBjaGFubmVsc09iamVjdCA9IGNoYXRDbGllbnRNYW5hZ2VyLmdldENoYXRDbGllbnQoKS5nZXRDaGFubmVscygpOwoKICAgICAgICBjaGFubmVsc09iamVjdC5nZXRQdWJsaWNDaGFubmVscyhuZXcgQ2FsbGJhY2tMaXN0ZW5lcjxQYWdpbmF0b3I8Q2hhbm5lbERlc2NyaXB0b3I+PigpIHsKICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgcHVibGljIHZvaWQgb25TdWNjZXNzKFBhZ2luYXRvcjxDaGFubmVsRGVzY3JpcHRvcj4gY2hhbm5lbERlc2NyaXB0b3JQYWdpbmF0b3IpIHsKICAgICAgICAgICAgZXh0cmFjdENoYW5uZWxzRnJvbVBhZ2luYXRvckFuZFBvcHVsYXRlKGNoYW5uZWxEZXNjcmlwdG9yUGFnaW5hdG9yLCBsaXN0ZW5lcik7CiAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICB9CiAgICB9KTsKICB9CgogIHByaXZhdGUgdm9pZCBleHRyYWN0Q2hhbm5lbHNGcm9tUGFnaW5hdG9yQW5kUG9wdWxhdGUoZmluYWwgUGFnaW5hdG9yPENoYW5uZWxEZXNjcmlwdG9yPiBjaGFubmVsc1BhZ2luYXRvciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbmFsIExvYWRDaGFubmVsTGlzdGVuZXIgbGlzdGVuZXIpIHsKICAgIGNoYW5uZWxzID0gbmV3IEFycmF5TGlzdDw+KCk7CiAgICBDaGFubmVsTWFuYWdlci50aGlzLmNoYW5uZWxzLmNsZWFyKCk7CiAgICBjaGFubmVsRXh0cmFjdG9yLmV4dHJhY3RBbmRTb3J0RnJvbUNoYW5uZWxEZXNjcmlwdG9yKGNoYW5uZWxzUGFnaW5hdG9yLAogICAgICAgIG5ldyBUYXNrQ29tcGxldGlvbkxpc3RlbmVyPExpc3Q8Q2hhbm5lbD4sIFN0cmluZz4oKSB7CiAgICAgIEBPdmVycmlkZQogICAgICBwdWJsaWMgdm9pZCBvblN1Y2Nlc3MoTGlzdDxDaGFubmVsPiBjaGFubmVscykgewogICAgICAgIENoYW5uZWxNYW5hZ2VyLnRoaXMuY2hhbm5lbHMuYWRkQWxsKGNoYW5uZWxzKTsKICAgICAgICBDb2xsZWN0aW9ucy5zb3J0KENoYW5uZWxNYW5hZ2VyLnRoaXMuY2hhbm5lbHMsIG5ldyBDdXN0b21DaGFubmVsQ29tcGFyYXRvcigpKTsKICAgICAgICBDaGFubmVsTWFuYWdlci50aGlzLmlzUmVmcmVzaGluZ0NoYW5uZWxzID0gZmFsc2U7CiAgICAgICAgY2hhdENsaWVudE1hbmFnZXIuc2V0Q2xpZW50TGlzdGVuZXIoQ2hhbm5lbE1hbmFnZXIudGhpcyk7CiAgICAgICAgbGlzdGVuZXIub25DaGFubmVsc0ZpbmlzaGVkTG9hZGluZyhDaGFubmVsTWFuYWdlci50aGlzLmNoYW5uZWxzKTsKICAgICAgfQoKICAgICAgQE92ZXJyaWRlCiAgICAgIHB1YmxpYyB2b2lkIG9uRXJyb3IoU3RyaW5nIGVycm9yVGV4dCkgewogICAgICAgIFN5c3RlbS5vdXQucHJpbnRsbigiRXJyb3IgcG9wdWxhdGluZyBjaGFubmVsczogIiArIGVycm9yVGV4dCk7CiAgICAgIH0KICAgIH0pOwogIH0KCiAgcHVibGljIHZvaWQgY3JlYXRlQ2hhbm5lbFdpdGhOYW1lKFN0cmluZyBuYW1lLCBmaW5hbCBTdGF0dXNMaXN0ZW5lciBoYW5kbGVyKSB7CiAgICB0aGlzLmNoYW5uZWxzT2JqZWN0CiAgICAgICAgLmNoYW5uZWxCdWlsZGVyKCkKICAgICAgICAud2l0aEZyaWVuZGx5TmFtZShuYW1lKQogICAgICAgIC53aXRoVHlwZShDaGFubmVsVHlwZS5QVUJMSUMpCiAgICAgICAgLmJ1aWxkKG5ldyBDYWxsYmFja0xpc3RlbmVyPENoYW5uZWw+KCkgewogICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICBwdWJsaWMgdm9pZCBvblN1Y2Nlc3MoZmluYWwgQ2hhbm5lbCBuZXdDaGFubmVsKSB7CiAgICAgICAgICAgIGhhbmRsZXIub25TdWNjZXNzKCk7CiAgICAgICAgICB9CgogICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICBwdWJsaWMgdm9pZCBvbkVycm9yKEVycm9ySW5mbyBlcnJvckluZm8pIHsKICAgICAgICAgICAgaGFuZGxlci5vbkVycm9yKGVycm9ySW5mbyk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgfQoKICBwdWJsaWMgdm9pZCBqb2luT3JDcmVhdGVHZW5lcmFsQ2hhbm5lbFdpdGhDb21wbGV0aW9uKGZpbmFsIFN0YXR1c0xpc3RlbmVyIGxpc3RlbmVyKSB7CiAgICBjaGFubmVsc09iamVjdC5nZXRDaGFubmVsKGRlZmF1bHRDaGFubmVsVW5pcXVlTmFtZSwgbmV3IENhbGxiYWNrTGlzdGVuZXI8Q2hhbm5lbD4oKSB7CiAgICAgIEBPdmVycmlkZQogICAgICBwdWJsaWMgdm9pZCBvblN1Y2Nlc3MoQ2hhbm5lbCBjaGFubmVsKSB7CiAgICAgICAgQ2hhbm5lbE1hbmFnZXIudGhpcy5nZW5lcmFsQ2hhbm5lbCA9IGNoYW5uZWw7CiAgICAgICAgaWYgKGNoYW5uZWwgIT0gbnVsbCkgewogICAgICAgICAgam9pbkdlbmVyYWxDaGFubmVsV2l0aENvbXBsZXRpb24obGlzdGVuZXIpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjcmVhdGVHZW5lcmFsQ2hhbm5lbFdpdGhDb21wbGV0aW9uKGxpc3RlbmVyKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0pOwogIH0KCiAgcHJpdmF0ZSB2b2lkIGpvaW5HZW5lcmFsQ2hhbm5lbFdpdGhDb21wbGV0aW9uKGZpbmFsIFN0YXR1c0xpc3RlbmVyIGxpc3RlbmVyKSB7CiAgICB0aGlzLmdlbmVyYWxDaGFubmVsLmpvaW4obmV3IFN0YXR1c0xpc3RlbmVyKCkgewogICAgICBAT3ZlcnJpZGUKICAgICAgcHVibGljIHZvaWQgb25TdWNjZXNzKCkgewogICAgICAgIGxpc3RlbmVyLm9uU3VjY2VzcygpOwogICAgICB9CgogICAgICBAT3ZlcnJpZGUKICAgICAgcHVibGljIHZvaWQgb25FcnJvcihFcnJvckluZm8gZXJyb3JJbmZvKSB7CiAgICAgICAgbGlzdGVuZXIub25FcnJvcihlcnJvckluZm8pOwogICAgICB9CiAgICB9KTsKICB9CgogIHByaXZhdGUgdm9pZCBjcmVhdGVHZW5lcmFsQ2hhbm5lbFdpdGhDb21wbGV0aW9uKGZpbmFsIFN0YXR1c0xpc3RlbmVyIGxpc3RlbmVyKSB7CiAgICB0aGlzLmNoYW5uZWxzT2JqZWN0CiAgICAgICAgLmNoYW5uZWxCdWlsZGVyKCkKICAgICAgICAud2l0aEZyaWVuZGx5TmFtZShkZWZhdWx0Q2hhbm5lbE5hbWUpCiAgICAgICAgLndpdGhVbmlxdWVOYW1lKGRlZmF1bHRDaGFubmVsVW5pcXVlTmFtZSkKICAgICAgICAud2l0aFR5cGUoQ2hhbm5lbFR5cGUuUFVCTElDKQogICAgICAgIC5idWlsZChuZXcgQ2FsbGJhY2tMaXN0ZW5lcjxDaGFubmVsPigpIHsKICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgcHVibGljIHZvaWQgb25TdWNjZXNzKGZpbmFsIENoYW5uZWwgY2hhbm5lbCkgewogICAgICAgICAgICBDaGFubmVsTWFuYWdlci50aGlzLmdlbmVyYWxDaGFubmVsID0gY2hhbm5lbDsKICAgICAgICAgICAgQ2hhbm5lbE1hbmFnZXIudGhpcy5jaGFubmVscy5hZGQoY2hhbm5lbCk7CiAgICAgICAgICAgIGpvaW5HZW5lcmFsQ2hhbm5lbFdpdGhDb21wbGV0aW9uKGxpc3RlbmVyKTsKICAgICAgICAgIH0KCiAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgIHB1YmxpYyB2b2lkIG9uRXJyb3IoRXJyb3JJbmZvIGVycm9ySW5mbykgewogICAgICAgICAgICBsaXN0ZW5lci5vbkVycm9yKGVycm9ySW5mbyk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgfQoKICBwdWJsaWMgdm9pZCBzZXRDaGFubmVsTGlzdGVuZXIoQ2hhdENsaWVudExpc3RlbmVyIGxpc3RlbmVyKSB7CiAgICB0aGlzLmxpc3RlbmVyID0gbGlzdGVuZXI7CiAgfQoKICBwcml2YXRlIFN0cmluZyBnZXRTdHJpbmdSZXNvdXJjZShpbnQgaWQpIHsKICAgIFJlc291cmNlcyByZXNvdXJjZXMgPSBUd2lsaW9DaGF0QXBwbGljYXRpb24uZ2V0KCkuZ2V0UmVzb3VyY2VzKCk7CiAgICByZXR1cm4gcmVzb3VyY2VzLmdldFN0cmluZyhpZCk7CiAgfQoKICBAT3ZlcnJpZGUKICBwdWJsaWMgdm9pZCBvbkNoYW5uZWxBZGQoQ2hhbm5lbCBjaGFubmVsKSB7CiAgICBpZiAobGlzdGVuZXIgIT0gbnVsbCkgewogICAgICBsaXN0ZW5lci5vbkNoYW5uZWxBZGQoY2hhbm5lbCk7CiAgICB9CiAgfQoKICBAT3ZlcnJpZGUKICBwdWJsaWMgdm9pZCBvbkNoYW5uZWxJbnZpdGUoQ2hhbm5lbCBjaGFubmVsKSB7CgogIH0KCiAgQE92ZXJyaWRlCiAgcHVibGljIHZvaWQgb25DaGFubmVsQ2hhbmdlKENoYW5uZWwgY2hhbm5lbCkgewogICAgaWYgKGxpc3RlbmVyICE9IG51bGwpIHsKICAgICAgbGlzdGVuZXIub25DaGFubmVsQ2hhbmdlKGNoYW5uZWwpOwogICAgfQogIH0KCiAgQE92ZXJyaWRlCiAgcHVibGljIHZvaWQgb25DaGFubmVsRGVsZXRlKENoYW5uZWwgY2hhbm5lbCkgewogICAgaWYgKGxpc3RlbmVyICE9IG51bGwpIHsKICAgICAgbGlzdGVuZXIub25DaGFubmVsRGVsZXRlKGNoYW5uZWwpOwogICAgfQogIH0KCiAgQE92ZXJyaWRlCiAgcHVibGljIHZvaWQgb25DaGFubmVsU3luY2hyb25pemF0aW9uQ2hhbmdlKENoYW5uZWwgY2hhbm5lbCkgewogICAgaWYgKGxpc3RlbmVyICE9IG51bGwpIHsKICAgICAgbGlzdGVuZXIub25DaGFubmVsU3luY2hyb25pemF0aW9uQ2hhbmdlKGNoYW5uZWwpOwogICAgfQogIH0KCiAgQE92ZXJyaWRlCiAgcHVibGljIHZvaWQgb25FcnJvcihFcnJvckluZm8gZXJyb3JJbmZvKSB7CiAgICBpZiAobGlzdGVuZXIgIT0gbnVsbCkgewogICAgICBsaXN0ZW5lci5vbkVycm9yKGVycm9ySW5mbyk7CiAgICB9CiAgfQoKICBAT3ZlcnJpZGUKICBwdWJsaWMgdm9pZCBvblVzZXJJbmZvQ2hhbmdlKFVzZXJJbmZvIHVzZXJJbmZvLCBVc2VySW5mby5VcGRhdGVSZWFzb24gdXBkYXRlUmVhc29uKSB7CiAgICBpZiAobGlzdGVuZXIgIT0gbnVsbCkgewogICAgICBsaXN0ZW5lci5vblVzZXJJbmZvQ2hhbmdlKHVzZXJJbmZvLCB1cGRhdGVSZWFzb24pOwogICAgfQogIH0KCiAgQE92ZXJyaWRlCiAgcHVibGljIHZvaWQgb25DbGllbnRTeW5jaHJvbml6YXRpb24oQ2hhdENsaWVudC5TeW5jaHJvbml6YXRpb25TdGF0dXMgc3luY2hyb25pemF0aW9uU3RhdHVzKSB7CgogIH0KCiAgQE92ZXJyaWRlCiAgcHVibGljIHZvaWQgb25Ub2FzdE5vdGlmaWNhdGlvbihTdHJpbmcgcywgU3RyaW5nIHMxKSB7CgogIH0KCiAgQE92ZXJyaWRlCiAgcHVibGljIHZvaWQgb25Ub2FzdFN1YnNjcmliZWQoKSB7CgogIH0KCiAgQE92ZXJyaWRlCiAgcHVibGljIHZvaWQgb25Ub2FzdEZhaWxlZChFcnJvckluZm8gZXJyb3JJbmZvKSB7CgogIH0KCiAgQE92ZXJyaWRlCiAgcHVibGljIHZvaWQgb25Db25uZWN0aW9uU3RhdGVDaGFuZ2UoQ2hhdENsaWVudC5Db25uZWN0aW9uU3RhdGUgY29ubmVjdGlvblN0YXRlKSB7CgogIH0KCiAgcHJpdmF0ZSBIYW5kbGVyIHNldHVwTGlzdGVuZXJIYW5kbGVyKCkgewogICAgTG9vcGVyIGxvb3BlcjsKICAgIEhhbmRsZXIgaGFuZGxlcjsKICAgIGlmICgobG9vcGVyID0gTG9vcGVyLm15TG9vcGVyKCkpICE9IG51bGwpIHsKICAgICAgaGFuZGxlciA9IG5ldyBIYW5kbGVyKGxvb3Blcik7CiAgICB9IGVsc2UgaWYgKChsb29wZXIgPSBMb29wZXIuZ2V0TWFpbkxvb3BlcigpKSAhPSBudWxsKSB7CiAgICAgIGhhbmRsZXIgPSBuZXcgSGFuZGxlcihsb29wZXIpOwogICAgfSBlbHNlIHsKICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbigiQ2hhbm5lbCBMaXN0ZW5lciBtdXN0IGhhdmUgYSBMb29wZXIuIik7CiAgICB9CiAgICByZXR1cm4gaGFuZGxlcjsKICB9Cn0K</textarea>
<textarea class="saurus-file" data-file="app/src/main/java/com/twilio/twiliochat/chat/MainChatActivity.java" data-mode="java">cGFja2FnZSBjb20udHdpbGlvLnR3aWxpb2NoYXQuY2hhdDsKCmltcG9ydCBhbmRyb2lkLmFwcC5BY3Rpdml0eTsKaW1wb3J0IGFuZHJvaWQuYXBwLlByb2dyZXNzRGlhbG9nOwppbXBvcnQgYW5kcm9pZC5jb250ZW50LkNvbnRleHQ7CmltcG9ydCBhbmRyb2lkLmNvbnRlbnQuRGlhbG9nSW50ZXJmYWNlOwppbXBvcnQgYW5kcm9pZC5jb250ZW50LkludGVudDsKaW1wb3J0IGFuZHJvaWQuY29udGVudC5yZXMuUmVzb3VyY2VzOwppbXBvcnQgYW5kcm9pZC5vcy5CdW5kbGU7CmltcG9ydCBhbmRyb2lkLm9zLkhhbmRsZXI7CmltcG9ydCBhbmRyb2lkLnN1cHBvcnQudjQuYXBwLkZyYWdtZW50VHJhbnNhY3Rpb247CmltcG9ydCBhbmRyb2lkLnN1cHBvcnQudjQudmlldy5HcmF2aXR5Q29tcGF0OwppbXBvcnQgYW5kcm9pZC5zdXBwb3J0LnY0LndpZGdldC5EcmF3ZXJMYXlvdXQ7CmltcG9ydCBhbmRyb2lkLnN1cHBvcnQudjQud2lkZ2V0LlN3aXBlUmVmcmVzaExheW91dDsKaW1wb3J0IGFuZHJvaWQuc3VwcG9ydC52Ny5hcHAuQWN0aW9uQmFyRHJhd2VyVG9nZ2xlOwppbXBvcnQgYW5kcm9pZC5zdXBwb3J0LnY3LmFwcC5BcHBDb21wYXRBY3Rpdml0eTsKaW1wb3J0IGFuZHJvaWQuc3VwcG9ydC52Ny53aWRnZXQuVG9vbGJhcjsKaW1wb3J0IGFuZHJvaWQudmlldy5NZW51OwppbXBvcnQgYW5kcm9pZC52aWV3Lk1lbnVJdGVtOwppbXBvcnQgYW5kcm9pZC52aWV3LlZpZXc7CmltcG9ydCBhbmRyb2lkLndpZGdldC5BZGFwdGVyVmlldzsKaW1wb3J0IGFuZHJvaWQud2lkZ2V0LkJ1dHRvbjsKaW1wb3J0IGFuZHJvaWQud2lkZ2V0Lkxpc3RWaWV3OwppbXBvcnQgYW5kcm9pZC53aWRnZXQuVGV4dFZpZXc7CgppbXBvcnQgY29tLnR3aWxpby5jaGF0LkNoYW5uZWw7CmltcG9ydCBjb20udHdpbGlvLmNoYXQuQ2hhdENsaWVudDsKaW1wb3J0IGNvbS50d2lsaW8uY2hhdC5DaGF0Q2xpZW50TGlzdGVuZXI7CmltcG9ydCBjb20udHdpbGlvLmNoYXQuRXJyb3JJbmZvOwppbXBvcnQgY29tLnR3aWxpby5jaGF0LlN0YXR1c0xpc3RlbmVyOwppbXBvcnQgY29tLnR3aWxpby5jaGF0LlVzZXJJbmZvOwppbXBvcnQgY29tLnR3aWxpby50d2lsaW9jaGF0LlI7CmltcG9ydCBjb20udHdpbGlvLnR3aWxpb2NoYXQuYXBwbGljYXRpb24uQWxlcnREaWFsb2dIYW5kbGVyOwppbXBvcnQgY29tLnR3aWxpby50d2lsaW9jaGF0LmFwcGxpY2F0aW9uLlNlc3Npb25NYW5hZ2VyOwppbXBvcnQgY29tLnR3aWxpby50d2lsaW9jaGF0LmFwcGxpY2F0aW9uLlR3aWxpb0NoYXRBcHBsaWNhdGlvbjsKaW1wb3J0IGNvbS50d2lsaW8udHdpbGlvY2hhdC5jaGF0LmNoYW5uZWxzLkNoYW5uZWxBZGFwdGVyOwppbXBvcnQgY29tLnR3aWxpby50d2lsaW9jaGF0LmNoYXQuY2hhbm5lbHMuQ2hhbm5lbE1hbmFnZXI7CmltcG9ydCBjb20udHdpbGlvLnR3aWxpb2NoYXQuY2hhdC5jaGFubmVscy5Mb2FkQ2hhbm5lbExpc3RlbmVyOwppbXBvcnQgY29tLnR3aWxpby50d2lsaW9jaGF0LmNoYXQubGlzdGVuZXJzLklucHV0T25DbGlja0xpc3RlbmVyOwppbXBvcnQgY29tLnR3aWxpby50d2lsaW9jaGF0LmNoYXQubGlzdGVuZXJzLlRhc2tDb21wbGV0aW9uTGlzdGVuZXI7CmltcG9ydCBjb20udHdpbGlvLnR3aWxpb2NoYXQubGFuZGluZy5Mb2dpbkFjdGl2aXR5OwoKaW1wb3J0IGphdmEudXRpbC5MaXN0OwoKcHVibGljIGNsYXNzIE1haW5DaGF0QWN0aXZpdHkgZXh0ZW5kcyBBcHBDb21wYXRBY3Rpdml0eSBpbXBsZW1lbnRzIENoYXRDbGllbnRMaXN0ZW5lciB7CiAgcHJpdmF0ZSBDb250ZXh0IGNvbnRleHQ7CiAgcHJpdmF0ZSBBY3Rpdml0eSBtYWluQWN0aXZpdHk7CiAgcHJpdmF0ZSBCdXR0b24gbG9nb3V0QnV0dG9uOwogIHByaXZhdGUgQnV0dG9uIGFkZENoYW5uZWxCdXR0b247CiAgcHJpdmF0ZSBUZXh0VmlldyB1c2VybmFtZVRleHRWaWV3OwogIHByaXZhdGUgQ2hhdENsaWVudE1hbmFnZXIgY2hhdENsaWVudE1hbmFnZXI7CiAgcHJpdmF0ZSBMaXN0VmlldyBjaGFubmVsc0xpc3RWaWV3OwogIHByaXZhdGUgQ2hhbm5lbEFkYXB0ZXIgY2hhbm5lbEFkYXB0ZXI7CiAgcHJpdmF0ZSBDaGFubmVsTWFuYWdlciBjaGFubmVsTWFuYWdlcjsKICBwcml2YXRlIE1haW5DaGF0RnJhZ21lbnQgY2hhdEZyYWdtZW50OwogIHByaXZhdGUgRHJhd2VyTGF5b3V0IGRyYXdlcjsKICBwcml2YXRlIFByb2dyZXNzRGlhbG9nIHByb2dyZXNzRGlhbG9nOwogIHByaXZhdGUgTWVudUl0ZW0gbGVhdmVDaGFubmVsTWVudUl0ZW07CiAgcHJpdmF0ZSBNZW51SXRlbSBkZWxldGVDaGFubmVsTWVudUl0ZW07CiAgcHJpdmF0ZSBTd2lwZVJlZnJlc2hMYXlvdXQgcmVmcmVzaExheW91dDsKCiAgQE92ZXJyaWRlCiAgcHJvdGVjdGVkIHZvaWQgb25EZXN0cm95KCkgewogICAgc3VwZXIub25EZXN0cm95KCk7CiAgICBuZXcgSGFuZGxlcigpLnBvc3QobmV3IFJ1bm5hYmxlKCkgewogICAgICBAT3ZlcnJpZGUKICAgICAgcHVibGljIHZvaWQgcnVuKCkgewogICAgICAgIGNoYXRDbGllbnRNYW5hZ2VyLnNodXRkb3duKCk7CiAgICAgICAgVHdpbGlvQ2hhdEFwcGxpY2F0aW9uLmdldCgpLmdldENoYXRDbGllbnRNYW5hZ2VyKCkuc2V0Q2hhdENsaWVudChudWxsKTsKICAgICAgfQogICAgfSk7CiAgfQoKICBAT3ZlcnJpZGUKICBwcm90ZWN0ZWQgdm9pZCBvbkNyZWF0ZShCdW5kbGUgc2F2ZWRJbnN0YW5jZVN0YXRlKSB7CiAgICBzdXBlci5vbkNyZWF0ZShzYXZlZEluc3RhbmNlU3RhdGUpOwogICAgc2V0Q29udGVudFZpZXcoUi5sYXlvdXQuYWN0aXZpdHlfbWFpbl9jaGF0KTsKICAgIFRvb2xiYXIgdG9vbGJhciA9IChUb29sYmFyKSBmaW5kVmlld0J5SWQoUi5pZC50b29sYmFyKTsKICAgIHNldFN1cHBvcnRBY3Rpb25CYXIodG9vbGJhcik7CgogICAgZHJhd2VyID0gKERyYXdlckxheW91dCkgZmluZFZpZXdCeUlkKFIuaWQuZHJhd2VyX2xheW91dCk7CiAgICBBY3Rpb25CYXJEcmF3ZXJUb2dnbGUgdG9nZ2xlID0gbmV3IEFjdGlvbkJhckRyYXdlclRvZ2dsZSh0aGlzLCBkcmF3ZXIsIHRvb2xiYXIsCiAgICAgICAgUi5zdHJpbmcubmF2aWdhdGlvbl9kcmF3ZXJfb3BlbiwgUi5zdHJpbmcubmF2aWdhdGlvbl9kcmF3ZXJfY2xvc2UpOwogICAgZHJhd2VyLnNldERyYXdlckxpc3RlbmVyKHRvZ2dsZSk7CiAgICB0b2dnbGUuc3luY1N0YXRlKCk7CgogICAgcmVmcmVzaExheW91dCA9IChTd2lwZVJlZnJlc2hMYXlvdXQpIGZpbmRWaWV3QnlJZChSLmlkLnJlZnJlc2hMYXlvdXQpOwoKICAgIEZyYWdtZW50VHJhbnNhY3Rpb24gZnJhZ21lbnRUcmFuc2FjdGlvbiA9IGdldFN1cHBvcnRGcmFnbWVudE1hbmFnZXIoKS5iZWdpblRyYW5zYWN0aW9uKCk7CgogICAgY2hhdEZyYWdtZW50ID0gbmV3IE1haW5DaGF0RnJhZ21lbnQoKTsKICAgIGZyYWdtZW50VHJhbnNhY3Rpb24uYWRkKFIuaWQuZnJhZ21lbnRfY29udGFpbmVyLCBjaGF0RnJhZ21lbnQpOwogICAgZnJhZ21lbnRUcmFuc2FjdGlvbi5jb21taXQoKTsKCiAgICBjb250ZXh0ID0gdGhpczsKICAgIG1haW5BY3Rpdml0eSA9IHRoaXM7CiAgICBsb2dvdXRCdXR0b24gPSAoQnV0dG9uKSBmaW5kVmlld0J5SWQoUi5pZC5idXR0b25Mb2dvdXQpOwogICAgYWRkQ2hhbm5lbEJ1dHRvbiA9IChCdXR0b24pIGZpbmRWaWV3QnlJZChSLmlkLmJ1dHRvbkFkZENoYW5uZWwpOwogICAgdXNlcm5hbWVUZXh0VmlldyA9IChUZXh0VmlldykgZmluZFZpZXdCeUlkKFIuaWQudGV4dFZpZXdVc2VybmFtZSk7CiAgICBjaGFubmVsc0xpc3RWaWV3ID0gKExpc3RWaWV3KSBmaW5kVmlld0J5SWQoUi5pZC5saXN0Vmlld0NoYW5uZWxzKTsKCiAgICBjaGFubmVsTWFuYWdlciA9IENoYW5uZWxNYW5hZ2VyLmdldEluc3RhbmNlKCk7CiAgICBzZXRVc2VybmFtZVRleHRWaWV3KCk7CgogICAgc2V0VXBMaXN0ZW5lcnMoKTsKICAgIGNoZWNrVHdpbGlvQ2xpZW50KCk7CiAgfQoKICBwcml2YXRlIHZvaWQgc2V0VXBMaXN0ZW5lcnMoKSB7CiAgICBsb2dvdXRCdXR0b24uc2V0T25DbGlja0xpc3RlbmVyKG5ldyBWaWV3Lk9uQ2xpY2tMaXN0ZW5lcigpIHsKICAgICAgQE92ZXJyaWRlCiAgICAgIHB1YmxpYyB2b2lkIG9uQ2xpY2soVmlldyB2KSB7CiAgICAgICAgcHJvbXB0TG9nb3V0KCk7CiAgICAgIH0KICAgIH0pOwogICAgYWRkQ2hhbm5lbEJ1dHRvbi5zZXRPbkNsaWNrTGlzdGVuZXIobmV3IFZpZXcuT25DbGlja0xpc3RlbmVyKCkgewogICAgICBAT3ZlcnJpZGUKICAgICAgcHVibGljIHZvaWQgb25DbGljayhWaWV3IHYpIHsKICAgICAgICBzaG93QWRkQ2hhbm5lbERpYWxvZygpOwogICAgICB9CiAgICB9KTsKICAgIHJlZnJlc2hMYXlvdXQuc2V0T25SZWZyZXNoTGlzdGVuZXIobmV3IFN3aXBlUmVmcmVzaExheW91dC5PblJlZnJlc2hMaXN0ZW5lcigpIHsKICAgICAgQE92ZXJyaWRlCiAgICAgIHB1YmxpYyB2b2lkIG9uUmVmcmVzaCgpIHsKICAgICAgICByZWZyZXNoTGF5b3V0LnNldFJlZnJlc2hpbmcodHJ1ZSk7CiAgICAgICAgcmVmcmVzaENoYW5uZWxzKCk7CiAgICAgIH0KICAgIH0pOwogICAgY2hhbm5lbHNMaXN0Vmlldy5zZXRPbkl0ZW1DbGlja0xpc3RlbmVyKG5ldyBBZGFwdGVyVmlldy5Pbkl0ZW1DbGlja0xpc3RlbmVyKCkgewogICAgICBAT3ZlcnJpZGUKICAgICAgcHVibGljIHZvaWQgb25JdGVtQ2xpY2soQWRhcHRlclZpZXc8Pz4gcGFyZW50LCBWaWV3IHZpZXcsIGludCBwb3NpdGlvbiwgbG9uZyBpZCkgewogICAgICAgIHNldENoYW5uZWwocG9zaXRpb24pOwogICAgICB9CiAgICB9KTsKICB9CgogIEBPdmVycmlkZQogIHB1YmxpYyB2b2lkIG9uQmFja1ByZXNzZWQoKSB7CiAgICBpZiAoZHJhd2VyLmlzRHJhd2VyT3BlbihHcmF2aXR5Q29tcGF0LlNUQVJUKSkgewogICAgICBkcmF3ZXIuY2xvc2VEcmF3ZXIoR3Jhdml0eUNvbXBhdC5TVEFSVCk7CiAgICB9IGVsc2UgewogICAgICBzdXBlci5vbkJhY2tQcmVzc2VkKCk7CiAgICB9CiAgfQoKICBAT3ZlcnJpZGUKICBwdWJsaWMgYm9vbGVhbiBvbkNyZWF0ZU9wdGlvbnNNZW51KE1lbnUgbWVudSkgewogICAgZ2V0TWVudUluZmxhdGVyKCkuaW5mbGF0ZShSLm1lbnUubWFpbl9jaGF0LCBtZW51KTsKICAgIHRoaXMubGVhdmVDaGFubmVsTWVudUl0ZW0gPSBtZW51LmZpbmRJdGVtKFIuaWQuYWN0aW9uX2xlYXZlX2NoYW5uZWwpOwogICAgdGhpcy5sZWF2ZUNoYW5uZWxNZW51SXRlbS5zZXRWaXNpYmxlKGZhbHNlKTsKICAgIHRoaXMuZGVsZXRlQ2hhbm5lbE1lbnVJdGVtID0gbWVudS5maW5kSXRlbShSLmlkLmFjdGlvbl9kZWxldGVfY2hhbm5lbCk7CiAgICB0aGlzLmRlbGV0ZUNoYW5uZWxNZW51SXRlbS5zZXRWaXNpYmxlKGZhbHNlKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgQE92ZXJyaWRlCiAgcHVibGljIGJvb2xlYW4gb25PcHRpb25zSXRlbVNlbGVjdGVkKE1lbnVJdGVtIGl0ZW0pIHsKICAgIGludCBpZCA9IGl0ZW0uZ2V0SXRlbUlkKCk7CgogICAgaWYgKGlkID09IFIuaWQuYWN0aW9uX2xlYXZlX2NoYW5uZWwpIHsKICAgICAgbGVhdmVDdXJyZW50Q2hhbm5lbCgpOwogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIGlmIChpZCA9PSBSLmlkLmFjdGlvbl9kZWxldGVfY2hhbm5lbCkgewogICAgICBwcm9tcHRDaGFubmVsRGVsZXRpb24oKTsKICAgIH0KCiAgICByZXR1cm4gc3VwZXIub25PcHRpb25zSXRlbVNlbGVjdGVkKGl0ZW0pOwogIH0KCiAgcHJpdmF0ZSBTdHJpbmcgZ2V0U3RyaW5nUmVzb3VyY2UoaW50IGlkKSB7CiAgICBSZXNvdXJjZXMgcmVzb3VyY2VzID0gZ2V0UmVzb3VyY2VzKCk7CiAgICByZXR1cm4gcmVzb3VyY2VzLmdldFN0cmluZyhpZCk7CiAgfQoKICBwcml2YXRlIHZvaWQgcmVmcmVzaENoYW5uZWxzKCkgewogICAgY2hhbm5lbE1hbmFnZXIucG9wdWxhdGVDaGFubmVscyhuZXcgTG9hZENoYW5uZWxMaXN0ZW5lcigpIHsKICAgICAgQE92ZXJyaWRlCiAgICAgIHB1YmxpYyB2b2lkIG9uQ2hhbm5lbHNGaW5pc2hlZExvYWRpbmcoZmluYWwgTGlzdDxDaGFubmVsPiBjaGFubmVscykgewogICAgICAgIHJ1bk9uVWlUaHJlYWQobmV3IFJ1bm5hYmxlKCkgewogICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICBwdWJsaWMgdm9pZCBydW4oKSB7CiAgICAgICAgICAgIGNoYW5uZWxBZGFwdGVyLnNldENoYW5uZWxzKGNoYW5uZWxzKTsKICAgICAgICAgICAgcmVmcmVzaExheW91dC5zZXRSZWZyZXNoaW5nKGZhbHNlKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfQogICAgfSk7CiAgfQoKICBwcml2YXRlIHZvaWQgcG9wdWxhdGVDaGFubmVscygpIHsKICAgIGNoYW5uZWxNYW5hZ2VyLnNldENoYW5uZWxMaXN0ZW5lcih0aGlzKTsKICAgIGNoYW5uZWxNYW5hZ2VyLnBvcHVsYXRlQ2hhbm5lbHMobmV3IExvYWRDaGFubmVsTGlzdGVuZXIoKSB7CiAgICAgIEBPdmVycmlkZQogICAgICBwdWJsaWMgdm9pZCBvbkNoYW5uZWxzRmluaXNoZWRMb2FkaW5nKExpc3Q8Q2hhbm5lbD4gY2hhbm5lbHMpIHsKICAgICAgICBjaGFubmVsQWRhcHRlciA9IG5ldyBDaGFubmVsQWRhcHRlcihtYWluQWN0aXZpdHksIGNoYW5uZWxzKTsKICAgICAgICBjaGFubmVsc0xpc3RWaWV3LnNldEFkYXB0ZXIoY2hhbm5lbEFkYXB0ZXIpOwogICAgICAgIE1haW5DaGF0QWN0aXZpdHkudGhpcy5jaGFubmVsTWFuYWdlcgogICAgICAgICAgICAuam9pbk9yQ3JlYXRlR2VuZXJhbENoYW5uZWxXaXRoQ29tcGxldGlvbihuZXcgU3RhdHVzTGlzdGVuZXIoKSB7CiAgICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgICAgcHVibGljIHZvaWQgb25TdWNjZXNzKCkgewogICAgICAgICAgICAgICAgcnVuT25VaVRocmVhZChuZXcgUnVubmFibGUoKSB7CiAgICAgICAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICAgICAgICBwdWJsaWMgdm9pZCBydW4oKSB7CiAgICAgICAgICAgICAgICAgICAgY2hhbm5lbEFkYXB0ZXIubm90aWZ5RGF0YVNldENoYW5nZWQoKTsKICAgICAgICAgICAgICAgICAgICBzdG9wQWN0aXZpdHlJbmRpY2F0b3IoKTsKICAgICAgICAgICAgICAgICAgICBzZXRDaGFubmVsKDApOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICAgIHB1YmxpYyB2b2lkIG9uRXJyb3IoRXJyb3JJbmZvIGVycm9ySW5mbykgewogICAgICAgICAgICAgICAgc2hvd0FsZXJ0V2l0aE1lc3NhZ2UoZ2V0U3RyaW5nUmVzb3VyY2UoUi5zdHJpbmcuZ2VuZXJpY19lcnJvcikpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgIH0KICAgIH0pOwogIH0KCiAgcHJpdmF0ZSB2b2lkIHNldENoYW5uZWwoZmluYWwgaW50IHBvc2l0aW9uKSB7CiAgICBMaXN0PENoYW5uZWw+IGNoYW5uZWxzID0gY2hhbm5lbE1hbmFnZXIuZ2V0Q2hhbm5lbHMoKTsKICAgIGlmIChjaGFubmVscyA9PSBudWxsKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGZpbmFsIENoYW5uZWwgY3VycmVudENoYW5uZWwgPSBjaGF0RnJhZ21lbnQuZ2V0Q3VycmVudENoYW5uZWwoKTsKICAgIGZpbmFsIENoYW5uZWwgc2VsZWN0ZWRDaGFubmVsID0gY2hhbm5lbHMuZ2V0KHBvc2l0aW9uKTsKICAgIGlmIChjdXJyZW50Q2hhbm5lbCAhPSBudWxsICYmIGN1cnJlbnRDaGFubmVsLmdldFNpZCgpLmNvbnRlbnRFcXVhbHMoc2VsZWN0ZWRDaGFubmVsLmdldFNpZCgpKSkgewogICAgICBkcmF3ZXIuY2xvc2VEcmF3ZXIoR3Jhdml0eUNvbXBhdC5TVEFSVCk7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGhpZGVNZW51SXRlbXMocG9zaXRpb24pOwogICAgaWYgKHNlbGVjdGVkQ2hhbm5lbCAhPSBudWxsKSB7CiAgICAgIHNob3dBY3Rpdml0eUluZGljYXRvcigiSm9pbmluZyAiICsgc2VsZWN0ZWRDaGFubmVsLmdldEZyaWVuZGx5TmFtZSgpICsgIiBjaGFubmVsIik7CiAgICAgIGlmIChjdXJyZW50Q2hhbm5lbCAhPSBudWxsICYmIGN1cnJlbnRDaGFubmVsLmdldFN0YXR1cygpID09IENoYW5uZWwuQ2hhbm5lbFN0YXR1cy5KT0lORUQpIHsKICAgICAgICB0aGlzLmNoYW5uZWxNYW5hZ2VyLmxlYXZlQ2hhbm5lbFdpdGhIYW5kbGVyKGN1cnJlbnRDaGFubmVsLCBuZXcgU3RhdHVzTGlzdGVuZXIoKSB7CiAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgIHB1YmxpYyB2b2lkIG9uU3VjY2VzcygpIHsKICAgICAgICAgICAgam9pbkNoYW5uZWwoc2VsZWN0ZWRDaGFubmVsKTsKICAgICAgICAgIH0KCiAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgIHB1YmxpYyB2b2lkIG9uRXJyb3IoRXJyb3JJbmZvIGVycm9ySW5mbykgewogICAgICAgICAgICBzdG9wQWN0aXZpdHlJbmRpY2F0b3IoKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgam9pbkNoYW5uZWwoc2VsZWN0ZWRDaGFubmVsKTsKICAgICAgc3RvcEFjdGl2aXR5SW5kaWNhdG9yKCk7CiAgICB9IGVsc2UgewogICAgICBzdG9wQWN0aXZpdHlJbmRpY2F0b3IoKTsKICAgICAgc2hvd0FsZXJ0V2l0aE1lc3NhZ2UoZ2V0U3RyaW5nUmVzb3VyY2UoUi5zdHJpbmcuZ2VuZXJpY19lcnJvcikpOwogICAgICBTeXN0ZW0ub3V0LnByaW50bG4oIlNlbGVjdGVkIGNoYW5uZWwgb3V0IG9mIHJhbmdlIik7CiAgICB9CiAgfQoKICBwcml2YXRlIHZvaWQgam9pbkNoYW5uZWwoZmluYWwgQ2hhbm5lbCBzZWxlY3RlZENoYW5uZWwpIHsKICAgIHJ1bk9uVWlUaHJlYWQobmV3IFJ1bm5hYmxlKCkgewogICAgICBAT3ZlcnJpZGUKICAgICAgcHVibGljIHZvaWQgcnVuKCkgewogICAgICAgIGNoYXRGcmFnbWVudC5zZXRDdXJyZW50Q2hhbm5lbChzZWxlY3RlZENoYW5uZWwsIG5ldyBTdGF0dXNMaXN0ZW5lcigpIHsKICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgcHVibGljIHZvaWQgb25TdWNjZXNzKCkgewogICAgICAgICAgICBNYWluQ2hhdEFjdGl2aXR5LnRoaXMuc3RvcEFjdGl2aXR5SW5kaWNhdG9yKCk7CiAgICAgICAgICB9CgogICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICBwdWJsaWMgdm9pZCBvbkVycm9yKEVycm9ySW5mbyBlcnJvckluZm8pIHsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICBzZXRUaXRsZShzZWxlY3RlZENoYW5uZWwuZ2V0RnJpZW5kbHlOYW1lKCkpOwogICAgICAgIGRyYXdlci5jbG9zZURyYXdlcihHcmF2aXR5Q29tcGF0LlNUQVJUKTsKICAgICAgfQogICAgfSk7CiAgfQoKICBwcml2YXRlIHZvaWQgaGlkZU1lbnVJdGVtcyhmaW5hbCBpbnQgcG9zaXRpb24pIHsKICAgIHJ1bk9uVWlUaHJlYWQobmV3IFJ1bm5hYmxlKCkgewogICAgICBAT3ZlcnJpZGUKICAgICAgcHVibGljIHZvaWQgcnVuKCkgewogICAgICAgIE1haW5DaGF0QWN0aXZpdHkudGhpcy5sZWF2ZUNoYW5uZWxNZW51SXRlbS5zZXRWaXNpYmxlKHBvc2l0aW9uICE9IDApOwogICAgICAgIE1haW5DaGF0QWN0aXZpdHkudGhpcy5kZWxldGVDaGFubmVsTWVudUl0ZW0uc2V0VmlzaWJsZShwb3NpdGlvbiAhPSAwKTsKICAgICAgfQogICAgfSk7CiAgfQoKICBwcml2YXRlIHZvaWQgc2hvd0FkZENoYW5uZWxEaWFsb2coKSB7CiAgICBTdHJpbmcgbWVzc2FnZSA9IGdldFN0cmluZ1Jlc291cmNlKFIuc3RyaW5nLm5ld19jaGFubmVsX3Byb21wdCk7CiAgICBBbGVydERpYWxvZ0hhbmRsZXIuZGlzcGxheUlucHV0RGlhbG9nKG1lc3NhZ2UsIGNvbnRleHQsIG5ldyBJbnB1dE9uQ2xpY2tMaXN0ZW5lcigpIHsKICAgICAgQE92ZXJyaWRlCiAgICAgIHB1YmxpYyB2b2lkIG9uQ2xpY2soU3RyaW5nIGlucHV0KSB7CiAgICAgICAgaWYgKGlucHV0Lmxlbmd0aCgpID09IDApIHsKICAgICAgICAgIHNob3dBbGVydFdpdGhNZXNzYWdlKGdldFN0cmluZ1Jlc291cmNlKFIuc3RyaW5nLmNoYW5uZWxfbmFtZV9yZXF1aXJlZF9tZXNzYWdlKSk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGNyZWF0ZUNoYW5uZWxXaXRoTmFtZShpbnB1dCk7CiAgICAgIH0KICAgIH0pOwogIH0KCiAgcHJpdmF0ZSB2b2lkIGNyZWF0ZUNoYW5uZWxXaXRoTmFtZShTdHJpbmcgbmFtZSkgewogICAgbmFtZSA9IG5hbWUudHJpbSgpOwogICAgaWYgKG5hbWUudG9Mb3dlckNhc2UoKQogICAgICAgIC5jb250ZW50RXF1YWxzKHRoaXMuY2hhbm5lbE1hbmFnZXIuZ2V0RGVmYXVsdENoYW5uZWxOYW1lKCkudG9Mb3dlckNhc2UoKSkpIHsKICAgICAgc2hvd0FsZXJ0V2l0aE1lc3NhZ2UoZ2V0U3RyaW5nUmVzb3VyY2UoUi5zdHJpbmcuY2hhbm5lbF9uYW1lX2VxdWFsc19kZWZhdWx0X25hbWUpKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy5jaGFubmVsTWFuYWdlci5jcmVhdGVDaGFubmVsV2l0aE5hbWUobmFtZSwgbmV3IFN0YXR1c0xpc3RlbmVyKCkgewogICAgICBAT3ZlcnJpZGUKICAgICAgcHVibGljIHZvaWQgb25TdWNjZXNzKCkgewogICAgICAgIHJlZnJlc2hDaGFubmVscygpOwogICAgICB9CgogICAgICBAT3ZlcnJpZGUKICAgICAgcHVibGljIHZvaWQgb25FcnJvcihFcnJvckluZm8gZXJyb3JJbmZvKSB7CiAgICAgICAgc2hvd0FsZXJ0V2l0aE1lc3NhZ2UoZ2V0U3RyaW5nUmVzb3VyY2UoUi5zdHJpbmcuZ2VuZXJpY19lcnJvcikpOwogICAgICB9CiAgICB9KTsKICB9CgogIHByaXZhdGUgdm9pZCBwcm9tcHRDaGFubmVsRGVsZXRpb24oKSB7CiAgICBTdHJpbmcgbWVzc2FnZSA9IGdldFN0cmluZ1Jlc291cmNlKFIuc3RyaW5nLmNoYW5uZWxfZGVsZXRlX3Byb21wdF9tZXNzYWdlKTsKICAgIEFsZXJ0RGlhbG9nSGFuZGxlci5kaXNwbGF5Q2FuY2VsbGFibGVBbGVydFdpdGhIYW5kbGVyKG1lc3NhZ2UsIGNvbnRleHQsCiAgICAgICAgbmV3IERpYWxvZ0ludGVyZmFjZS5PbkNsaWNrTGlzdGVuZXIoKSB7CiAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgIHB1YmxpYyB2b2lkIG9uQ2xpY2soRGlhbG9nSW50ZXJmYWNlIGRpYWxvZywgaW50IHdoaWNoKSB7CiAgICAgICAgICAgIGRlbGV0ZUN1cnJlbnRDaGFubmVsKCk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgfQoKICBwcml2YXRlIHZvaWQgZGVsZXRlQ3VycmVudENoYW5uZWwoKSB7CiAgICBDaGFubmVsIGN1cnJlbnRDaGFubmVsID0gY2hhdEZyYWdtZW50LmdldEN1cnJlbnRDaGFubmVsKCk7CiAgICBjaGFubmVsTWFuYWdlci5kZWxldGVDaGFubmVsV2l0aEhhbmRsZXIoY3VycmVudENoYW5uZWwsIG5ldyBTdGF0dXNMaXN0ZW5lcigpIHsKICAgICAgQE92ZXJyaWRlCiAgICAgIHB1YmxpYyB2b2lkIG9uU3VjY2VzcygpIHsKICAgICAgfQoKICAgICAgQE92ZXJyaWRlCiAgICAgIHB1YmxpYyB2b2lkIG9uRXJyb3IoRXJyb3JJbmZvIGVycm9ySW5mbykgewogICAgICAgIHNob3dBbGVydFdpdGhNZXNzYWdlKGdldFN0cmluZ1Jlc291cmNlKFIuc3RyaW5nLm1lc3NhZ2VfZGVsZXRpb25fZm9yYmlkZGVuKSk7CiAgICAgIH0KICAgIH0pOwogIH0KCiAgcHJpdmF0ZSB2b2lkIGxlYXZlQ3VycmVudENoYW5uZWwoKSB7CiAgICBmaW5hbCBDaGFubmVsIGN1cnJlbnRDaGFubmVsID0gY2hhdEZyYWdtZW50LmdldEN1cnJlbnRDaGFubmVsKCk7CiAgICBpZiAoY3VycmVudENoYW5uZWwuZ2V0U3RhdHVzKCkgPT0gQ2hhbm5lbC5DaGFubmVsU3RhdHVzLk5PVF9QQVJUSUNJUEFUSU5HKSB7CiAgICAgIHNldENoYW5uZWwoMCk7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNoYW5uZWxNYW5hZ2VyLmxlYXZlQ2hhbm5lbFdpdGhIYW5kbGVyKGN1cnJlbnRDaGFubmVsLCBuZXcgU3RhdHVzTGlzdGVuZXIoKSB7CiAgICAgIEBPdmVycmlkZQogICAgICBwdWJsaWMgdm9pZCBvblN1Y2Nlc3MoKSB7CiAgICAgICAgc2V0Q2hhbm5lbCgwKTsKICAgICAgfQoKICAgICAgQE92ZXJyaWRlCiAgICAgIHB1YmxpYyB2b2lkIG9uRXJyb3IoRXJyb3JJbmZvIGVycm9ySW5mbykgewogICAgICAgIHN0b3BBY3Rpdml0eUluZGljYXRvcigpOwogICAgICB9CiAgICB9KTsKICB9CgogIHByaXZhdGUgdm9pZCBjaGVja1R3aWxpb0NsaWVudCgpIHsKICAgIHNob3dBY3Rpdml0eUluZGljYXRvcihnZXRTdHJpbmdSZXNvdXJjZShSLnN0cmluZy5sb2FkaW5nX2NoYW5uZWxzX21lc3NhZ2UpKTsKICAgIGNoYXRDbGllbnRNYW5hZ2VyID0gVHdpbGlvQ2hhdEFwcGxpY2F0aW9uLmdldCgpLmdldENoYXRDbGllbnRNYW5hZ2VyKCk7CiAgICBpZiAoY2hhdENsaWVudE1hbmFnZXIuZ2V0Q2hhdENsaWVudCgpID09IG51bGwpIHsKICAgICAgaW5pdGlhbGl6ZUNsaWVudCgpOwogICAgfSBlbHNlIHsKICAgICAgcG9wdWxhdGVDaGFubmVscygpOwogICAgfQogIH0KCiAgcHJpdmF0ZSB2b2lkIGluaXRpYWxpemVDbGllbnQoKSB7CiAgICBjaGF0Q2xpZW50TWFuYWdlci5jb25uZWN0Q2xpZW50KG5ldyBUYXNrQ29tcGxldGlvbkxpc3RlbmVyPFZvaWQsIFN0cmluZz4oKSB7CiAgICAgIEBPdmVycmlkZQogICAgICBwdWJsaWMgdm9pZCBvblN1Y2Nlc3MoVm9pZCBhVm9pZCkgewogICAgICAgIHBvcHVsYXRlQ2hhbm5lbHMoKTsKICAgICAgfQoKICAgICAgQE92ZXJyaWRlCiAgICAgIHB1YmxpYyB2b2lkIG9uRXJyb3IoU3RyaW5nIGVycm9yTWVzc2FnZSkgewogICAgICAgIHN0b3BBY3Rpdml0eUluZGljYXRvcigpOwogICAgICAgIHNob3dBbGVydFdpdGhNZXNzYWdlKCJDbGllbnQgY29ubmVjdGlvbiBlcnJvciIpOwogICAgICB9CiAgICB9KTsKICB9CgogIHByaXZhdGUgdm9pZCBwcm9tcHRMb2dvdXQoKSB7CiAgICBmaW5hbCBTdHJpbmcgbWVzc2FnZSA9IGdldFN0cmluZ1Jlc291cmNlKFIuc3RyaW5nLmxvZ291dF9wcm9tcHRfbWVzc2FnZSk7CiAgICBydW5PblVpVGhyZWFkKG5ldyBSdW5uYWJsZSgpIHsKICAgICAgQE92ZXJyaWRlCiAgICAgIHB1YmxpYyB2b2lkIHJ1bigpIHsKICAgICAgICBBbGVydERpYWxvZ0hhbmRsZXIuZGlzcGxheUNhbmNlbGxhYmxlQWxlcnRXaXRoSGFuZGxlcihtZXNzYWdlLCBjb250ZXh0LAogICAgICAgICAgICBuZXcgRGlhbG9nSW50ZXJmYWNlLk9uQ2xpY2tMaXN0ZW5lcigpIHsKICAgICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgICBwdWJsaWMgdm9pZCBvbkNsaWNrKERpYWxvZ0ludGVyZmFjZSBkaWFsb2csIGludCB3aGljaCkgewogICAgICAgICAgICAgICAgU2Vzc2lvbk1hbmFnZXIuZ2V0SW5zdGFuY2UoKS5sb2dvdXRVc2VyKCk7CiAgICAgICAgICAgICAgICBzaG93TG9naW5BY3Rpdml0eSgpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgIH0KICAgIH0pOwoKICB9CgogIHByaXZhdGUgdm9pZCBzaG93TG9naW5BY3Rpdml0eSgpIHsKICAgIEludGVudCBsYXVuY2hJbnRlbnQgPSBuZXcgSW50ZW50KCk7CiAgICBsYXVuY2hJbnRlbnQuc2V0Q2xhc3MoZ2V0QXBwbGljYXRpb25Db250ZXh0KCksIExvZ2luQWN0aXZpdHkuY2xhc3MpOwogICAgc3RhcnRBY3Rpdml0eShsYXVuY2hJbnRlbnQpOwogICAgZmluaXNoKCk7CiAgfQoKICBwcml2YXRlIHZvaWQgc2V0VXNlcm5hbWVUZXh0VmlldygpIHsKICAgIFN0cmluZyB1c2VybmFtZSA9CiAgICAgICAgU2Vzc2lvbk1hbmFnZXIuZ2V0SW5zdGFuY2UoKS5nZXRVc2VyRGV0YWlscygpLmdldChTZXNzaW9uTWFuYWdlci5LRVlfVVNFUk5BTUUpOwogICAgdXNlcm5hbWVUZXh0Vmlldy5zZXRUZXh0KHVzZXJuYW1lKTsKICB9CgogIHByaXZhdGUgdm9pZCBzdG9wQWN0aXZpdHlJbmRpY2F0b3IoKSB7CiAgICBydW5PblVpVGhyZWFkKG5ldyBSdW5uYWJsZSgpIHsKICAgICAgQE92ZXJyaWRlCiAgICAgIHB1YmxpYyB2b2lkIHJ1bigpIHsKICAgICAgICBpZiAocHJvZ3Jlc3NEaWFsb2cuaXNTaG93aW5nKCkpIHsKICAgICAgICAgIHByb2dyZXNzRGlhbG9nLmRpc21pc3MoKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0pOwogIH0KCiAgcHJpdmF0ZSB2b2lkIHNob3dBY3Rpdml0eUluZGljYXRvcihmaW5hbCBTdHJpbmcgbWVzc2FnZSkgewogICAgcnVuT25VaVRocmVhZChuZXcgUnVubmFibGUoKSB7CiAgICAgIEBPdmVycmlkZQogICAgICBwdWJsaWMgdm9pZCBydW4oKSB7CiAgICAgICAgcHJvZ3Jlc3NEaWFsb2cgPSBuZXcgUHJvZ3Jlc3NEaWFsb2coTWFpbkNoYXRBY3Rpdml0eS50aGlzLm1haW5BY3Rpdml0eSk7CiAgICAgICAgcHJvZ3Jlc3NEaWFsb2cuc2V0TWVzc2FnZShtZXNzYWdlKTsKICAgICAgICBwcm9ncmVzc0RpYWxvZy5zaG93KCk7CiAgICAgICAgcHJvZ3Jlc3NEaWFsb2cuc2V0Q2FuY2VsZWRPblRvdWNoT3V0c2lkZShmYWxzZSk7CiAgICAgICAgcHJvZ3Jlc3NEaWFsb2cuc2V0Q2FuY2VsYWJsZShmYWxzZSk7CiAgICAgIH0KICAgIH0pOwogIH0KCiAgcHJpdmF0ZSB2b2lkIHNob3dBbGVydFdpdGhNZXNzYWdlKGZpbmFsIFN0cmluZyBtZXNzYWdlKSB7CiAgICBydW5PblVpVGhyZWFkKG5ldyBSdW5uYWJsZSgpIHsKICAgICAgQE92ZXJyaWRlCiAgICAgIHB1YmxpYyB2b2lkIHJ1bigpIHsKICAgICAgICBBbGVydERpYWxvZ0hhbmRsZXIuZGlzcGxheUFsZXJ0V2l0aE1lc3NhZ2UobWVzc2FnZSwgY29udGV4dCk7CiAgICAgIH0KICAgIH0pOwogIH0KCiAgQE92ZXJyaWRlCiAgcHVibGljIHZvaWQgb25DaGFubmVsQWRkKENoYW5uZWwgY2hhbm5lbCkgewogICAgU3lzdGVtLm91dC5wcmludGxuKCJDaGFubmVsIEFkZGVkIik7CiAgICByZWZyZXNoQ2hhbm5lbHMoKTsKICB9CgogIEBPdmVycmlkZQogIHB1YmxpYyB2b2lkIG9uQ2hhbm5lbERlbGV0ZShmaW5hbCBDaGFubmVsIGNoYW5uZWwpIHsKICAgIFN5c3RlbS5vdXQucHJpbnRsbigiQ2hhbm5lbCBEZWxldGVkIik7CiAgICBDaGFubmVsIGN1cnJlbnRDaGFubmVsID0gY2hhdEZyYWdtZW50LmdldEN1cnJlbnRDaGFubmVsKCk7CiAgICBpZiAoY2hhbm5lbC5nZXRTaWQoKS5jb250ZW50RXF1YWxzKGN1cnJlbnRDaGFubmVsLmdldFNpZCgpKSkgewogICAgICBjaGF0RnJhZ21lbnQuc2V0Q3VycmVudENoYW5uZWwobnVsbCwgbnVsbCk7CiAgICAgIHNldENoYW5uZWwoMCk7CiAgICB9CiAgICByZWZyZXNoQ2hhbm5lbHMoKTsKICB9CgogIEBPdmVycmlkZQogIHB1YmxpYyB2b2lkIG9uQ2hhbm5lbEludml0ZShDaGFubmVsIGNoYW5uZWwpIHsKCiAgfQoKICBAT3ZlcnJpZGUKICBwdWJsaWMgdm9pZCBvbkNoYW5uZWxTeW5jaHJvbml6YXRpb25DaGFuZ2UoQ2hhbm5lbCBjaGFubmVsKSB7CgogIH0KCiAgQE92ZXJyaWRlCiAgcHVibGljIHZvaWQgb25FcnJvcihFcnJvckluZm8gZXJyb3JJbmZvKSB7CgogIH0KCiAgQE92ZXJyaWRlCiAgcHVibGljIHZvaWQgb25Vc2VySW5mb0NoYW5nZShVc2VySW5mbyB1c2VySW5mbywgVXNlckluZm8uVXBkYXRlUmVhc29uIHVwZGF0ZVJlYXNvbikgewoKICB9CgogIEBPdmVycmlkZQogIHB1YmxpYyB2b2lkIG9uQ2xpZW50U3luY2hyb25pemF0aW9uKENoYXRDbGllbnQuU3luY2hyb25pemF0aW9uU3RhdHVzIHN5bmNocm9uaXphdGlvblN0YXR1cykgewoKICB9CgogIEBPdmVycmlkZQogIHB1YmxpYyB2b2lkIG9uVG9hc3ROb3RpZmljYXRpb24oU3RyaW5nIHMsIFN0cmluZyBzMSkgewoKICB9CgogIEBPdmVycmlkZQogIHB1YmxpYyB2b2lkIG9uVG9hc3RTdWJzY3JpYmVkKCkgewoKICB9CgogIEBPdmVycmlkZQogIHB1YmxpYyB2b2lkIG9uVG9hc3RGYWlsZWQoRXJyb3JJbmZvIGVycm9ySW5mbykgewoKICB9CgogIEBPdmVycmlkZQogIHB1YmxpYyB2b2lkIG9uQ29ubmVjdGlvblN0YXRlQ2hhbmdlKENoYXRDbGllbnQuQ29ubmVjdGlvblN0YXRlIGNvbm5lY3Rpb25TdGF0ZSkgewoKICB9CgogIEBPdmVycmlkZQogIHB1YmxpYyB2b2lkIG9uQ2hhbm5lbENoYW5nZShDaGFubmVsIGNoYW5uZWwpIHsKICB9Cn0K</textarea>
<textarea class="saurus-file" data-file="app/src/main/java/com/twilio/twiliochat/chat/MainChatFragment.java" data-mode="java">cGFja2FnZSBjb20udHdpbGlvLnR3aWxpb2NoYXQuY2hhdDsKCmltcG9ydCBhbmRyb2lkLmFwcC5BY3Rpdml0eTsKaW1wb3J0IGFuZHJvaWQuY29udGVudC5Db250ZXh0OwppbXBvcnQgYW5kcm9pZC5vcy5CdW5kbGU7CmltcG9ydCBhbmRyb2lkLnN1cHBvcnQudjQuYXBwLkZyYWdtZW50OwppbXBvcnQgYW5kcm9pZC52aWV3LktleUV2ZW50OwppbXBvcnQgYW5kcm9pZC52aWV3LkxheW91dEluZmxhdGVyOwppbXBvcnQgYW5kcm9pZC52aWV3LlZpZXc7CmltcG9ydCBhbmRyb2lkLnZpZXcuVmlld0dyb3VwOwppbXBvcnQgYW5kcm9pZC53aWRnZXQuQnV0dG9uOwppbXBvcnQgYW5kcm9pZC53aWRnZXQuRWRpdFRleHQ7CmltcG9ydCBhbmRyb2lkLndpZGdldC5MaXN0VmlldzsKaW1wb3J0IGFuZHJvaWQud2lkZ2V0LlRleHRWaWV3OwoKaW1wb3J0IGNvbS50d2lsaW8uY2hhdC5DYWxsYmFja0xpc3RlbmVyOwppbXBvcnQgY29tLnR3aWxpby5jaGF0LkNoYW5uZWw7CmltcG9ydCBjb20udHdpbGlvLmNoYXQuQ2hhbm5lbExpc3RlbmVyOwppbXBvcnQgY29tLnR3aWxpby5jaGF0LkVycm9ySW5mbzsKaW1wb3J0IGNvbS50d2lsaW8uY2hhdC5NZW1iZXI7CmltcG9ydCBjb20udHdpbGlvLmNoYXQuTWVzc2FnZTsKaW1wb3J0IGNvbS50d2lsaW8uY2hhdC5NZXNzYWdlczsKaW1wb3J0IGNvbS50d2lsaW8uY2hhdC5TdGF0dXNMaXN0ZW5lcjsKaW1wb3J0IGNvbS50d2lsaW8udHdpbGlvY2hhdC5SOwppbXBvcnQgY29tLnR3aWxpby50d2lsaW9jaGF0LmNoYXQubWVzc2FnZXMuSm9pbmVkU3RhdHVzTWVzc2FnZTsKaW1wb3J0IGNvbS50d2lsaW8udHdpbGlvY2hhdC5jaGF0Lm1lc3NhZ2VzLkxlZnRTdGF0dXNNZXNzYWdlOwppbXBvcnQgY29tLnR3aWxpby50d2lsaW9jaGF0LmNoYXQubWVzc2FnZXMuTWVzc2FnZUFkYXB0ZXI7CmltcG9ydCBjb20udHdpbGlvLnR3aWxpb2NoYXQuY2hhdC5tZXNzYWdlcy5TdGF0dXNNZXNzYWdlOwoKaW1wb3J0IGphdmEudXRpbC5MaXN0OwoKcHVibGljIGNsYXNzIE1haW5DaGF0RnJhZ21lbnQgZXh0ZW5kcyBGcmFnbWVudCBpbXBsZW1lbnRzIENoYW5uZWxMaXN0ZW5lciB7CiAgQ29udGV4dCBjb250ZXh0OwogIEFjdGl2aXR5IG1haW5BY3Rpdml0eTsKICBCdXR0b24gc2VuZEJ1dHRvbjsKICBMaXN0VmlldyBtZXNzYWdlc0xpc3RWaWV3OwogIEVkaXRUZXh0IG1lc3NhZ2VUZXh0RWRpdDsKCiAgTWVzc2FnZUFkYXB0ZXIgbWVzc2FnZUFkYXB0ZXI7CiAgQ2hhbm5lbCBjdXJyZW50Q2hhbm5lbDsKICBNZXNzYWdlcyBtZXNzYWdlc09iamVjdDsKCiAgcHVibGljIE1haW5DaGF0RnJhZ21lbnQoKSB7CiAgfQoKICBwdWJsaWMgc3RhdGljIE1haW5DaGF0RnJhZ21lbnQgbmV3SW5zdGFuY2UoKSB7CiAgICBNYWluQ2hhdEZyYWdtZW50IGZyYWdtZW50ID0gbmV3IE1haW5DaGF0RnJhZ21lbnQoKTsKICAgIHJldHVybiBmcmFnbWVudDsKICB9CgogIEBPdmVycmlkZQogIHB1YmxpYyB2b2lkIG9uQ3JlYXRlKEJ1bmRsZSBzYXZlZEluc3RhbmNlU3RhdGUpIHsKICAgIHN1cGVyLm9uQ3JlYXRlKHNhdmVkSW5zdGFuY2VTdGF0ZSk7CiAgICBjb250ZXh0ID0gdGhpcy5nZXRBY3Rpdml0eSgpOwogICAgbWFpbkFjdGl2aXR5ID0gdGhpcy5nZXRBY3Rpdml0eSgpOwogIH0KCiAgQE92ZXJyaWRlCiAgcHVibGljIFZpZXcgb25DcmVhdGVWaWV3KExheW91dEluZmxhdGVyIGluZmxhdGVyLCBWaWV3R3JvdXAgY29udGFpbmVyLAogICAgICAgICAgICAgICAgICAgICAgICAgICBCdW5kbGUgc2F2ZWRJbnN0YW5jZVN0YXRlKSB7CiAgICBWaWV3IHZpZXcgPSBpbmZsYXRlci5pbmZsYXRlKFIubGF5b3V0LmZyYWdtZW50X21haW5fY2hhdCwgY29udGFpbmVyLCBmYWxzZSk7CiAgICBzZW5kQnV0dG9uID0gKEJ1dHRvbikgdmlldy5maW5kVmlld0J5SWQoUi5pZC5idXR0b25TZW5kKTsKICAgIG1lc3NhZ2VzTGlzdFZpZXcgPSAoTGlzdFZpZXcpIHZpZXcuZmluZFZpZXdCeUlkKFIuaWQubGlzdFZpZXdNZXNzYWdlcyk7CiAgICBtZXNzYWdlVGV4dEVkaXQgPSAoRWRpdFRleHQpIHZpZXcuZmluZFZpZXdCeUlkKFIuaWQuZWRpdFRleHRNZXNzYWdlKTsKCiAgICBtZXNzYWdlQWRhcHRlciA9IG5ldyBNZXNzYWdlQWRhcHRlcihtYWluQWN0aXZpdHkpOwogICAgbWVzc2FnZXNMaXN0Vmlldy5zZXRBZGFwdGVyKG1lc3NhZ2VBZGFwdGVyKTsKICAgIHNldFVwTGlzdGVuZXJzKCk7CiAgICBzZXRNZXNzYWdlSW5wdXRFbmFibGVkKGZhbHNlKTsKCiAgICByZXR1cm4gdmlldzsKICB9CgogIEBPdmVycmlkZQogIHB1YmxpYyB2b2lkIG9uQXR0YWNoKENvbnRleHQgY29udGV4dCkgewogICAgc3VwZXIub25BdHRhY2goY29udGV4dCk7CiAgfQoKICBAT3ZlcnJpZGUKICBwdWJsaWMgdm9pZCBvbkRldGFjaCgpIHsKICAgIHN1cGVyLm9uRGV0YWNoKCk7CiAgfQoKICBwdWJsaWMgQ2hhbm5lbCBnZXRDdXJyZW50Q2hhbm5lbCgpIHsKICAgIHJldHVybiBjdXJyZW50Q2hhbm5lbDsKICB9CgogIHB1YmxpYyB2b2lkIHNldEN1cnJlbnRDaGFubmVsKENoYW5uZWwgY3VycmVudENoYW5uZWwsIGZpbmFsIFN0YXR1c0xpc3RlbmVyIGhhbmRsZXIpIHsKICAgIGlmIChjdXJyZW50Q2hhbm5lbCA9PSBudWxsKSB7CiAgICAgIHRoaXMuY3VycmVudENoYW5uZWwgPSBudWxsOwogICAgICByZXR1cm47CiAgICB9CiAgICBpZiAoIWN1cnJlbnRDaGFubmVsLmVxdWFscyh0aGlzLmN1cnJlbnRDaGFubmVsKSkgewogICAgICBzZXRNZXNzYWdlSW5wdXRFbmFibGVkKGZhbHNlKTsKICAgICAgdGhpcy5jdXJyZW50Q2hhbm5lbCA9IGN1cnJlbnRDaGFubmVsOwogICAgICB0aGlzLmN1cnJlbnRDaGFubmVsLmFkZExpc3RlbmVyKHRoaXMpOwogICAgICBpZiAodGhpcy5jdXJyZW50Q2hhbm5lbC5nZXRTdGF0dXMoKSA9PSBDaGFubmVsLkNoYW5uZWxTdGF0dXMuSk9JTkVEKSB7CiAgICAgICAgbG9hZE1lc3NhZ2VzKGhhbmRsZXIpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuY3VycmVudENoYW5uZWwuam9pbihuZXcgU3RhdHVzTGlzdGVuZXIoKSB7CiAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgIHB1YmxpYyB2b2lkIG9uU3VjY2VzcygpIHsKICAgICAgICAgICAgbG9hZE1lc3NhZ2VzKGhhbmRsZXIpOwogICAgICAgICAgfQoKICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgcHVibGljIHZvaWQgb25FcnJvcihFcnJvckluZm8gZXJyb3JJbmZvKSB7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KICB9CgogIHByaXZhdGUgdm9pZCBsb2FkTWVzc2FnZXMoZmluYWwgU3RhdHVzTGlzdGVuZXIgaGFuZGxlcikgewogICAgdGhpcy5tZXNzYWdlc09iamVjdCA9IHRoaXMuY3VycmVudENoYW5uZWwuZ2V0TWVzc2FnZXMoKTsKCiAgICBpZiAobWVzc2FnZXNPYmplY3QgIT0gbnVsbCkgewogICAgICBtZXNzYWdlc09iamVjdC5nZXRMYXN0TWVzc2FnZXMoMTAwLCBuZXcgQ2FsbGJhY2tMaXN0ZW5lcjxMaXN0PE1lc3NhZ2U+PigpIHsKICAgICAgICBAT3ZlcnJpZGUKICAgICAgICBwdWJsaWMgdm9pZCBvblN1Y2Nlc3MoTGlzdDxNZXNzYWdlPiBtZXNzYWdlTGlzdCkgewogICAgICAgICAgbWVzc2FnZUFkYXB0ZXIuc2V0TWVzc2FnZXMobWVzc2FnZUxpc3QpOwogICAgICAgICAgc2V0TWVzc2FnZUlucHV0RW5hYmxlZCh0cnVlKTsKICAgICAgICAgIG1lc3NhZ2VUZXh0RWRpdC5yZXF1ZXN0Rm9jdXMoKTsKICAgICAgICAgIGhhbmRsZXIub25TdWNjZXNzKCk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KICB9CgogIHByaXZhdGUgdm9pZCBzZXRVcExpc3RlbmVycygpIHsKICAgIHNlbmRCdXR0b24uc2V0T25DbGlja0xpc3RlbmVyKG5ldyBWaWV3Lk9uQ2xpY2tMaXN0ZW5lcigpIHsKICAgICAgQE92ZXJyaWRlCiAgICAgIHB1YmxpYyB2b2lkIG9uQ2xpY2soVmlldyB2KSB7CiAgICAgICAgc2VuZE1lc3NhZ2UoKTsKICAgICAgfQogICAgfSk7CiAgICBtZXNzYWdlVGV4dEVkaXQuc2V0T25FZGl0b3JBY3Rpb25MaXN0ZW5lcihuZXcgVGV4dFZpZXcuT25FZGl0b3JBY3Rpb25MaXN0ZW5lcigpIHsKICAgICAgQE92ZXJyaWRlCiAgICAgIHB1YmxpYyBib29sZWFuIG9uRWRpdG9yQWN0aW9uKFRleHRWaWV3IHYsIGludCBhY3Rpb25JZCwgS2V5RXZlbnQgZXZlbnQpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgIH0pOwogIH0KCiAgcHJpdmF0ZSB2b2lkIHNlbmRNZXNzYWdlKCkgewogICAgU3RyaW5nIG1lc3NhZ2VUZXh0ID0gZ2V0VGV4dElucHV0KCk7CiAgICBpZiAobWVzc2FnZVRleHQubGVuZ3RoKCkgPT0gMCkgewogICAgICByZXR1cm47CiAgICB9CiAgICBNZXNzYWdlIG5ld01lc3NhZ2UgPSB0aGlzLm1lc3NhZ2VzT2JqZWN0LmNyZWF0ZU1lc3NhZ2UobWVzc2FnZVRleHQpOwogICAgdGhpcy5tZXNzYWdlc09iamVjdC5zZW5kTWVzc2FnZShuZXdNZXNzYWdlLCBudWxsKTsKICAgIGNsZWFyVGV4dElucHV0KCk7CiAgfQoKICBwcml2YXRlIHZvaWQgc2V0TWVzc2FnZUlucHV0RW5hYmxlZChmaW5hbCBib29sZWFuIGVuYWJsZWQpIHsKICAgIG1haW5BY3Rpdml0eS5ydW5PblVpVGhyZWFkKG5ldyBSdW5uYWJsZSgpIHsKICAgICAgQE92ZXJyaWRlCiAgICAgIHB1YmxpYyB2b2lkIHJ1bigpIHsKICAgICAgICBNYWluQ2hhdEZyYWdtZW50LnRoaXMuc2VuZEJ1dHRvbi5zZXRFbmFibGVkKGVuYWJsZWQpOwogICAgICAgIE1haW5DaGF0RnJhZ21lbnQudGhpcy5tZXNzYWdlVGV4dEVkaXQuc2V0RW5hYmxlZChlbmFibGVkKTsKICAgICAgfQogICAgfSk7CiAgfQoKICBwcml2YXRlIFN0cmluZyBnZXRUZXh0SW5wdXQoKSB7CiAgICByZXR1cm4gbWVzc2FnZVRleHRFZGl0LmdldFRleHQoKS50b1N0cmluZygpOwogIH0KCiAgcHJpdmF0ZSB2b2lkIGNsZWFyVGV4dElucHV0KCkgewogICAgbWVzc2FnZVRleHRFZGl0LnNldFRleHQoIiIpOwogIH0KCiAgQE92ZXJyaWRlCiAgcHVibGljIHZvaWQgb25NZXNzYWdlQWRkKE1lc3NhZ2UgbWVzc2FnZSkgewogICAgbWVzc2FnZUFkYXB0ZXIuYWRkTWVzc2FnZShtZXNzYWdlKTsKICB9CgogIEBPdmVycmlkZQogIHB1YmxpYyB2b2lkIG9uTWVtYmVySm9pbihNZW1iZXIgbWVtYmVyKSB7CiAgICBTdGF0dXNNZXNzYWdlIHN0YXR1c01lc3NhZ2UgPSBuZXcgSm9pbmVkU3RhdHVzTWVzc2FnZShtZW1iZXIuZ2V0VXNlckluZm8oKS5nZXRJZGVudGl0eSgpKTsKICAgIHRoaXMubWVzc2FnZUFkYXB0ZXIuYWRkU3RhdHVzTWVzc2FnZShzdGF0dXNNZXNzYWdlKTsKICB9CgogIEBPdmVycmlkZQogIHB1YmxpYyB2b2lkIG9uTWVtYmVyRGVsZXRlKE1lbWJlciBtZW1iZXIpIHsKICAgIFN0YXR1c01lc3NhZ2Ugc3RhdHVzTWVzc2FnZSA9IG5ldyBMZWZ0U3RhdHVzTWVzc2FnZShtZW1iZXIuZ2V0VXNlckluZm8oKS5nZXRJZGVudGl0eSgpKTsKICAgIHRoaXMubWVzc2FnZUFkYXB0ZXIuYWRkU3RhdHVzTWVzc2FnZShzdGF0dXNNZXNzYWdlKTsKICB9CgogIEBPdmVycmlkZQogIHB1YmxpYyB2b2lkIG9uTWVzc2FnZUNoYW5nZShNZXNzYWdlIG1lc3NhZ2UpIHsKICB9CgogIEBPdmVycmlkZQogIHB1YmxpYyB2b2lkIG9uTWVzc2FnZURlbGV0ZShNZXNzYWdlIG1lc3NhZ2UpIHsKICB9CgogIEBPdmVycmlkZQogIHB1YmxpYyB2b2lkIG9uTWVtYmVyQ2hhbmdlKE1lbWJlciBtZW1iZXIpIHsKICB9CgogIEBPdmVycmlkZQogIHB1YmxpYyB2b2lkIG9uVHlwaW5nU3RhcnRlZChNZW1iZXIgbWVtYmVyKSB7CiAgfQoKICBAT3ZlcnJpZGUKICBwdWJsaWMgdm9pZCBvblR5cGluZ0VuZGVkKE1lbWJlciBtZW1iZXIpIHsKICB9CgogIEBPdmVycmlkZQogIHB1YmxpYyB2b2lkIG9uU3luY2hyb25pemF0aW9uQ2hhbmdlKENoYW5uZWwgY2hhbm5lbCkgewogIH0KfQo=</textarea>
</div>
</div><div class="saurus-overview"><ul></ul></div></div><div class="saurus-code"><div class="file-path"><span class="crumb-container"></span><i class="fa fa-fw fa-folder"></i></div><div class="saurus-editor"></div></div><div class="saurus-explorer"><div class="saurus-file-list"></div><a href="https://github.com/TwilioDevEd/twiliochat-android" target="_blank" class="explorer-get-code"> <i class="fa fa-lg fa-github-square"> </i>View Code on GitHub</a></div></div></div></div><script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/backbone.js/1.1.2/backbone-min.js"></script><script src="ace/ace.js"></script><script src="ace/theme-monokai.js"></script><script src="viewsaurus.js"></script></body></html>